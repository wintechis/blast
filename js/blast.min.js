/*
 https://www.gnu.org/licenses/agpl-3.0.de.html AGPLv3
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var f=e[g];if(!(f in d))return;d=d[f]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function g(f){f.done?d(f.value):Promise.resolve(f.value).then(b,c).then(g,e)}g(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,g){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(f){return f instanceof e?f:new e(function(l,h){l(f)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(f){if(null==this.batch_){this.batch_=[];var l=this;this.asyncExecuteFunction(function(){l.executeBatch_()})}this.batch_.push(f)};
var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(f){d(f,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var f=this.batch_;this.batch_=[];for(var l=0;l<f.length;++l){var h=f[l];f[l]=null;try{h()}catch(k){this.asyncThrow_(k)}}}this.batch_=null};b.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;})};var e=function(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var l=this.createResolveAndReject_();
try{f(l.resolve,l.reject)}catch(h){l.reject(h)}};e.prototype.createResolveAndReject_=function(){function f(k){return function(m){h||(h=!0,k.call(l,m))}}var l=this,h=!1;return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};e.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof e)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var l=null!=f;break a;case "function":l=!0;break a;default:l=!1}l?this.resolveToNonPromiseObj_(f):
this.fulfill_(f)}};e.prototype.resolveToNonPromiseObj_=function(f){var l=void 0;try{l=f.then}catch(h){this.reject_(h);return}"function"==typeof l?this.settleSameAsThenable_(l,f):this.fulfill_(f)};e.prototype.reject_=function(f){this.settle_(2,f)};e.prototype.fulfill_=function(f){this.settle_(1,f)};e.prototype.settle_=function(f,l){if(0!=this.state_)throw Error("Cannot settle("+f+", "+l+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=l;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var f=this;d(function(){if(f.notifyUnhandledRejection_()){var l=$jscomp.global.console;"undefined"!==typeof l&&l.error(f.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var f=$jscomp.global.CustomEvent,l=$jscomp.global.Event,h=$jscomp.global.dispatchEvent;if("undefined"===typeof h)return!0;"function"===typeof f?f=new f("unhandledrejection",{cancelable:!0}):
"function"===typeof l?f=new l("unhandledrejection",{cancelable:!0}):(f=$jscomp.global.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.result_;return h(f)};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)g.asyncExecute(this.onSettledCallbacks_[f]);this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(f){var l=this.createResolveAndReject_();
f.callWhenSettled_(l.resolve,l.reject)};e.prototype.settleSameAsThenable_=function(f,l){var h=this.createResolveAndReject_();try{f.call(l,h.resolve,h.reject)}catch(k){h.reject(k)}};e.prototype.then=function(f,l){function h(p,q){return"function"==typeof p?function(r){try{k(p(r))}catch(t){m(t)}}:q}var k,m,n=new e(function(p,q){k=p;m=q});this.callWhenSettled_(h(f,k),h(l,m));return n};e.prototype.catch=function(f){return this.then(void 0,f)};e.prototype.callWhenSettled_=function(f,l){function h(){switch(k.state_){case 1:f(k.result_);
break;case 2:l(k.result_);break;default:throw Error("Unexpected state: "+k.state_);}}var k=this;null==this.onSettledCallbacks_?g.asyncExecute(h):this.onSettledCallbacks_.push(h);this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(f){return new e(function(l,h){h(f)})};e.race=function(f){return new e(function(l,h){for(var k=$jscomp.makeIterator(f),m=k.next();!m.done;m=k.next())c(m.value).callWhenSettled_(l,h)})};e.all=function(f){var l=$jscomp.makeIterator(f),h=l.next();return h.done?c([]):new e(function(k,
m){function n(r){return function(t){p[r]=t;q--;0==q&&k(p)}}var p=[],q=0;do p.push(void 0),q++,c(h.value).callWhenSettled_(n(p.length-1),m),h=l.next();while(!h.done)})};return e},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var k=Object.seal({}),m=Object.seal({}),n=new a([[k,2],[m,3]]);if(2!=n.get(k)||3!=n.get(m))return!1;n.delete(k);n.set(m,4);return!n.has(k)&&4==n.get(m)}catch(p){return!1}}function c(){}function d(k){var m=typeof k;return"object"===m&&null!==k||"function"===m}function e(k){if(!$jscomp.owns(k,f)){var m=new c;$jscomp.defineProperty(k,f,{value:m})}}function g(k){if(!$jscomp.ISOLATE_POLYFILLS){var m=Object[k];m&&(Object[k]=
function(n){if(n instanceof c)return n;Object.isExtensible(n)&&e(n);return m(n)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var f="$jscomp_hidden_"+Math.random();g("freeze");g("preventExtensions");g("seal");var l=0,h=function(k){this.id_=(l+=Math.random()+1).toString();if(k){k=$jscomp.makeIterator(k);for(var m;!(m=k.next()).done;)m=m.value,this.set(m[0],m[1])}};h.prototype.set=function(k,m){if(!d(k))throw Error("Invalid WeakMap key");
e(k);if(!$jscomp.owns(k,f))throw Error("WeakMap key fail: "+k);k[f][this.id_]=m;return this};h.prototype.get=function(k){return d(k)&&$jscomp.owns(k,f)?k[f][this.id_]:void 0};h.prototype.has=function(k){return d(k)&&$jscomp.owns(k,f)&&$jscomp.owns(k[f],this.id_)};h.prototype.delete=function(k){return d(k)&&$jscomp.owns(k,f)&&$jscomp.owns(k[f],this.id_)?delete k[f][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),k=new a($jscomp.makeIterator([[h,"s"]]));if("s"!=k.get(h)||1!=k.size||k.get({x:4})||k.set({x:4},"t")!=k||2!=k.size)return!1;var m=k.entries(),n=m.next();if(n.done||n.value[0]!=h||"s"!=n.value[1])return!1;n=m.next();return n.done||4!=n.value[0].x||"t"!=n.value[1]||!m.next().done?!1:!0}catch(p){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(h){this.data_={};this.head_=f();this.size=0;if(h){h=$jscomp.makeIterator(h);for(var k;!(k=h.next()).done;)k=k.value,this.set(k[0],k[1])}};d.prototype.set=function(h,k){h=0===h?0:h;var m=e(this,h);m.list||(m.list=this.data_[m.id]=[]);m.entry?m.entry.value=k:(m.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:h,value:k},m.list.push(m.entry),
this.head_.previous.next=m.entry,this.head_.previous=m.entry,this.size++);return this};d.prototype.delete=function(h){h=e(this,h);return h.entry&&h.list?(h.list.splice(h.index,1),h.list.length||delete this.data_[h.id],h.entry.previous.next=h.entry.next,h.entry.next.previous=h.entry.previous,h.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};d.prototype.has=function(h){return!!e(this,h).entry};d.prototype.get=function(h){return(h=
e(this,h).entry)&&h.value};d.prototype.entries=function(){return g(this,function(h){return[h.key,h.value]})};d.prototype.keys=function(){return g(this,function(h){return h.key})};d.prototype.values=function(){return g(this,function(h){return h.value})};d.prototype.forEach=function(h,k){for(var m=this.entries(),n;!(n=m.next()).done;)n=n.value,h.call(k,n[1],n[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(h,k){var m=k&&typeof k;"object"==m||"function"==m?c.has(k)?m=c.get(k):
(m=""+ ++l,c.set(k,m)):m="p_"+k;var n=h.data_[m];if(n&&$jscomp.owns(h.data_,m))for(h=0;h<n.length;h++){var p=n[h];if(k!==k&&p.key!==p.key||k===p.key)return{id:m,list:n,index:h,entry:p}}return{id:m,list:n,index:-1,entry:void 0}},g=function(h,k){var m=h.head_;return $jscomp.iteratorPrototype(function(){if(m){for(;m.head!=h.head_;)m=m.previous;for(;m.next!=m.head;)return m=m.next,{done:!1,value:k(m)};m=null}return{done:!0,value:void 0}})},f=function(){var h={};return h.previous=h.next=h.head=h},l=0;
return d},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var g=d[c];if(g===b||Object.is(g,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");
$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,b-d.length)+d}},"es8","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Array.from",function(a){return a?a:function(b,c,d){c=null!=c?c:function(l){return l};var e=[],g="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof g){b=g.call(b);for(var f=0;!(g=b.next()).done;)e.push(c.call(d,g.value,f++))}else for(g=b.length,f=0;f<g;f++)e.push(c.call(d,b[f],f));return e}},"es6","es3");var Blast={States:{}};Blast.States.Interpreter=null;
Blast.States.runner_=null;Blast.States.latestCode="";Blast.States.eventCode=new Map;Blast.States.eventValues=new Map;Blast.States.eventChecker=function(a,b){var c=Blast.States.eventValues.get(a);Blast.States.eventValues.set(a,b);return void 0!=c?!c&&b:!1};Blast.States.addEventCode=function(a,b){Blast.States.eventCode.set(a,b)};Blast.States.removeEventCode=function(a){Blast.States.eventCode.delete(a)};
Blast.States.generateCode=function(){for(var a="while (true) {\n \n}",b=Blast.workspace.getBlocksByType("event",!1).map(function(g){return g.id}),c=$jscomp.makeIterator(Blast.States.eventCode),d=c.next();!d.done;d=c.next()){var e=$jscomp.makeIterator(d.value);d=e.next().value;e=e.next().value;b.includes(d)&&(a=a.slice(0,-2)+e+"\n"+a.slice(-1))}Blast.States.latestCode=Blockly.JavaScript.finish(a)};
Blast.States.startEventChecker=function(){Blast.States.Interpreter=null;Blast.States.Interpreter=new Interpreter("");Blast.States.Interpreter.stateStack[0].scope=Blast.Interpreter.globalScope;Blast.States.Interpreter.appendCode(Blast.States.latestCode);Blast.States.runner_=function(){if(Blast.States.Interpreter)try{Blast.States.Interpreter.step(),setTimeout(Blast.States.runner_,5)}catch(a){Blockly.alert("Error executing program:\n%e".replace("%e",a)),Blast.setStatus(Blast.status.ERROR),Blast.resetInterpreter(),
console.error(a)}};Blast.States.runner_()};Blast.States.allStates=function(a){return a.getBlocksByType("state_definition",!1).map(function(b){return b.getStateDef()[0]})};Blast.States.findLegalName=function(a,b){if(b.isInFlyout)return a;for(a=a||Blockly.Msg.UNNAMED_KEY||"unnamed";!Blast.States.isLegalName_(a,b.workspace,b);){var c=a.match(/^(.*?)(\d+)$/);a=c?c[1]+(parseInt(c[2],10)+1):a+"2"}return a};Blast.States.isLegalName_=function(a,b,c){return!Blast.States.isNameUsed(a,b,c)};
Blast.States.isNameUsed=function(a,b,c){b=b.getAllBlocks(!1);b=$jscomp.makeIterator(b);for(var d=b.next();!d.done;d=b.next())if(d=d.value,d!=c&&d.getStateDef&&(d=d.getStateDef()[0],Blockly.Names.equals(d,a)))return!0;return!1};
Blast.States.rename=function(a){a=a.trim();var b=Blast.States.findLegalName(a,this.getSourceBlock()),c=this.getValue();if(c!=a&&c!=b){a=this.getSourceBlock().workspace.getAllBlocks(!1);a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())d=d.value,d.renameState&&d.renameState(c,b)}return b};
Blast.States.flyoutCategory=function(a){var b=[];if(Blockly.Blocks.state_definition){var c=Blockly.utils.xml.createElement("block");c.setAttribute("type","state_definition");c.setAttribute("gap",16);var d=Blockly.utils.xml.createElement("field");d.setAttribute("name","NAME");d.appendChild(Blockly.utils.xml.createTextNode("state name"));c.appendChild(d);b.push(c)}b.length&&b[b.length-1].setAttribute("gap",24);a=Blast.States.allStates(a);0==a.length&&(c=Blockly.utils.xml.createElement("block"),c.setAttribute("type",
"event"),c.setAttribute("gap",16),c.setAttribute("disabled",!0),d=Blockly.utils.xml.createElement("mutation"),d.setAttribute("name","state name"),c.appendChild(d),b.push(c));a=$jscomp.makeIterator(a);for(c=a.next();!c.done;c=a.next()){c=c.value;d=Blockly.utils.xml.createElement("block");d.setAttribute("type","event");d.setAttribute("gap",16);var e=Blockly.utils.xml.createElement("mutation");e.setAttribute("name",c);d.appendChild(e);b.push(d)}if(a=Blast.Toolbox.getCategory("States and Events"))for(a=
$jscomp.makeIterator(a.contents),c=a.next();!c.done;c=a.next())c=c.value,d=Blockly.utils.xml.createElement("block"),d.setAttribute("type",c.type),d.setAttribute("gap",16),b.push(d);return b};Blast.States.getEvents=function(a,b){var c=[];b=b.getAllBlocks(!1);b=$jscomp.makeIterator(b);for(var d=b.next();!d.done;d=b.next())if(d=d.value,d.getStateName){var e=d.getStateName();e&&Blockly.Names.equals(e,a)&&c.push(d)}return c};
Blast.States.getDefinition=function(a,b){b=b.getTopBlocks(!1);b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next())if(c=c.value,c.getStateDef){var d=c.getStateDef()[0];if(d&&Blockly.Names.equals(d,a))return c}return null};Blast.Ui={};Blast.Ui.TABS_=["workspace","javascript","xml"];Blast.Ui.selected_="workspace";Blast.Ui.playIcon_='<span class="icon material-icons">play_arrow</span>';Blast.Ui.stopIcon_='<span class="icon material-icons">stop</span>';Blast.Ui.messageCounter_=0;Blast.Ui.messageOutputContainer=null;Blast.Ui.statusContainer=null;Blast.Ui.uriInput=null;Blast.Ui.runButton=null;
Blast.Ui.addElementToOutputContainer=function(a){100<Blast.Ui.messageCounter_&&Blast.Ui.messageOutputContainer.firstChild.remove();Blast.Ui.messageOutputContainer.appendChild(a,Blast.Ui.messageOutputContainer.firstChild);Blast.Ui.messageOutputContainer.scrollTop=Blast.Ui.messageOutputContainer.scrollHeight};
Blast.Ui.addMessage=function(a,b){var c="media/logo-512x512.png";window.location.href.includes("mobile")&&(c="../"+c);document.hasFocus()||navigator.serviceWorker.ready.then(function(e){e.showNotification("Blast",{body:a,icon:c,vibrate:[200,100,200,100,200,100,200]})});var d=document.createElement("div");d.classList.add("message");b&&d.classList.add(b+"-message");d.id="message-"+Blast.Ui.messageCounter_++;b=document.createTextNode(a);d.appendChild(b);b=document.createElement("span");b.classList.add("time");
b.innerHTML=(new Date).toLocaleTimeString();d.appendChild(b);Blast.Ui.addElementToOutputContainer(d)};
Blast.Ui.tabClick_=function(a){for(var b=$jscomp.makeIterator(Blast.Ui.TABS_),c=b.next();!c.done;c=b.next()){c=c.value;var d=document.getElementById("tab_"+c);d.classList.add("taboff");d.classList.remove("tabon");document.getElementById("content_"+c).style.visibility="hidden"}Blast.Ui.selected_=a;b=document.getElementById("tab_"+a);b.classList.remove("taboff");b.classList.add("tabon");document.getElementById("content_"+a).style.visibility="visible";Blockly.svgResize(Blast.workspace)};
Blast.Ui.renderContent_=function(){var a=document.getElementById("content_xml"),b=Blockly.Xml.workspaceToDom(Blast.workspace);b=Blockly.Xml.domToPrettyText(b);a.value=b;a.focus();a=document.getElementById("content_javascript");a.textContent=Blast.latestCode.replace(/highlightBlock\('.*'\);\n/gm,"");a.className=a.className.replace("prettyprinted","");"object"==typeof PR&&PR.prettyPrint()};
Blast.Ui.setStatus=function(a){if(a===Blast.status.RUNNING){var b=Blast.stopJS;var c=Blast.Ui.stopIcon_;var d="Stop the execution"}else b=Blast.runJS,c=Blast.Ui.playIcon_,d="Run block program";Blast.Ui.runButton.onclick=b;Blast.Ui.runButton.title=d;Blast.Ui.runButton.innerHTML=c;Blast.Ui.statusContainer.innerHTML=a};
Blast.Ui.init=function(){Blast.Ui.uriInput=document.getElementById("loadWorkspace-input");Blast.Ui.runButton=document.getElementById("runButton");Blast.Ui.messageOutputContainer=document.getElementById("msgOutputContainer");Blast.Ui.statusContainer=document.getElementById("statusContainer");if(!window.location.href.includes("mobile")){Blast.Ui.tabClick_(Blast.Ui.selected_);for(var a=$jscomp.makeIterator(Blast.Ui.TABS_),b=a.next();!b.done;b=a.next())b=b.value,Blast.bindClick("tab_"+b,function(c){return function(){Blast.Ui.tabClick_(c)}}(b));
Blast.bindClick("UriLoadButton",Blast.Storage.load);Blast.bindClick("UriSaveButton",Blast.Storage.link);Blast.bindClick("saveButton",function(){Blast.Storage.link(!0)});Blast.Ui.uriInput.addEventListener("keyup",function(c){13===c.keyCode&&Blast.Storage.load()})}};Blast.Toolbox={};
var defaultToolbox={kind:"categoryToolbox",contents:[{kind:"CATEGORY",contents:[],name:"Things and Resources",custom:"THINGS",colour:"60"},{kind:"sep",gap:"32"},{kind:"CATEGORY",contents:[],name:"Properties",colour:"255"},{kind:"CATEGORY",contents:[],name:"Actions",colour:"0"},{kind:"CATEGORY",contents:[],name:"States and Events",custom:"STATES",colour:"180"},{kind:"sep",gap:"32"},{kind:"CATEGORY",contents:[],name:"Requests and Queries",colour:"0"},{kind:"sep",gap:"32"},{kind:"CATEGORY",contents:[{kind:"BLOCK",
type:"repeat"},{kind:"BLOCK",type:"while_until"},{kind:"BLOCK",type:"for"},{kind:"BLOCK",type:"wait_seconds"},{kind:"BLOCK",type:"break_continue"},{kind:"BLOCK",type:"conditional_statement"}],name:"Control Flow",colour:"120"},{kind:"CATEGORY",contents:[{kind:"BLOCK",type:"logic_compare"},{kind:"BLOCK",type:"logic_operation"},{kind:"BLOCK",type:"logic_negate"}],name:"Boolean Expressions",colour:"210"},{kind:"CATEGORY",contents:[],name:"Functions",colour:"290",custom:"PROCEDURE"},{kind:"sep",gap:"32"},
{kind:"CATEGORY",contents:[{kind:"BLOCK",type:"string"},{kind:"BLOCK",type:"string_join"},{kind:"BLOCK",type:"string_length"},{kind:"BLOCK",type:"string_indexOf"},{kind:"BLOCK",type:"string_charAt"},{kind:"BLOCK",type:"string_getSubstring"},{kind:"BLOCK",type:"string_changeCase"},{kind:"BLOCK",type:"string_replace"},{kind:"BLOCK",type:"string_showPrompt"}],name:"Strings",colour:"160"},{kind:"CATEGORY",contents:[{kind:"BLOCK",type:"number_value"},{kind:"BLOCK",type:"number_infinity"},{kind:"BLOCK",
type:"number_arithmetic"},{kind:"BLOCK",type:"number_modulo"},{kind:"BLOCK",type:"number_random"}],name:"Numbers",colour:"230"},{kind:"CATEGORY",contents:[{kind:"BLOCK",type:"logic_boolean"}],name:"Booleans",colour:"210"},{kind:"sep",gap:"32"},{kind:"CATEGORY",contents:[],name:"Variables",custom:"VARIABLE",colour:"330"}]};Blast.Toolbox.currentToolbox=defaultToolbox;
Blast.Toolbox.init=function(){Blast.workspace.registerToolboxCategoryCallback("STATES",Blast.States.flyoutCategory);Blast.workspace.registerToolboxCategoryCallback("THINGS",Blast.Things.flyoutCategory)};Blast.Toolbox.getCategory=function(a){return Blast.Toolbox.currentToolbox.contents.find(function(b){return b.name?b.name.toLowerCase()===a.toLowerCase():!1})};Blast.Toolbox.addBlock=function(a,b,c){a={kind:"BLOCK",type:a,blockxml:c};(b=Blast.Toolbox.getCategory(b))&&b.contents.push(a)};Blast.config={};Blast.workspace=null;Blast.highlightPause=!1;Blast.apiFunctions=[];Blast.asyncApiFunctions=[];Blast.latestCode="";Blast.Interpreter=null;Blast.Interrupted=!1;Blast.eventInWorkspace=[];Blast.deviceEventHandlers=[];Blast.runner_=null;Blast.status={READY:"ready",RUNNING:"running",STOPPED:"stopped",ERROR:"error"};Blast.bindClick=function(a,b){"string"==typeof a&&(a=document.getElementById(a));a.addEventListener("click",b,!0);a.addEventListener("touchend",b,!0)};
Blast.importPrettify=function(){var a=document.createElement("script");a.setAttribute("src","https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js");document.head.appendChild(a)};Blast.getBBox_=function(a){var b=a.offsetHeight,c=a.offsetWidth,d=0,e=0;do d+=a.offsetLeft,e+=a.offsetTop,a=a.offsetParent;while(a);return{height:b,width:c,x:d,y:e}};
Blast.init=function(){if(!window.location.href.includes("mobile")){var a=document.getElementById("content_area"),b=function(){for(var c=Blast.getBBox_(a),d=$jscomp.makeIterator(Blast.Ui.TABS_),e=d.next();!e.done;e=d.next())e=document.getElementById("content_"+e.value),e.style.top=c.y+"px",e.style.left=c.x+"px",e.style.height=c.height+"px",e.style.height=2*c.height-e.offsetHeight+"px",e.style.width=c.width+"px",e.style.width=2*c.width-e.offsetWidth+"px";Blast.workspace&&Blast.workspace.getToolbox().width&&
(document.getElementById("tab_workspace").style.minWidth=Blast.workspace.getToolbox().width-38+"px")};window.addEventListener("resize",b,!1);Blast.workspace=Blockly.inject("content_workspace",{media:"media/",toolbox:Blast.Toolbox.currentToolbox,zoom:{controls:!0,wheel:!0}});Blast.Toolbox.init();b();Blockly.svgResize(Blast.workspace);Blast.Ui.init();Blast.Ui.setStatus(Blast.status.READY);Blast.generateCode();Blast.workspace.addChangeListener(function(c){c instanceof Blockly.Events.Ui||(Blast.generateCode(),
Blast.States.generateCode(),Blast.Ui.renderContent_())});Blast.Ui.addMessage("Actionblock output will be displayed here","info");window.setTimeout(Blast.importPrettify,1)}};Blast.highlightBlock=function(a){Blast.workspace.highlightBlock(a);Blast.highlightPause=!0};Blast.resetUi=function(a){Blast.workspace.highlightBlock(null);Blast.highlightPause=!1;Blast.Ui.setStatus(a)};
Blast.generateCode=function(){Blockly.JavaScript.STATEMENT_PREFIX="highlightBlock(%1);\n";Blockly.JavaScript.addReservedWords("highlightBlock");Blast.latestCode="";Blast.latestCode=Blockly.JavaScript.workspaceToCode(Blast.workspace)};Blast.resetInterpreter=function(){Blast.Interpreter=null;Blast.runner_&&(clearTimeout(Blast.runner_),Blast.runner_=null);Blast.Bluetooth.tearDown()};
Blast.removeDeviceHandlers=function(){for(var a=$jscomp.makeIterator(Blast.deviceEventHandlers),b=a.next();!b.done;b=a.next())b=b.value,b.device.removeEventListener(b.type,b.fn);Blast.deviceEventHandlers=[]};
Blast.runJS=function(){Blast.resetUi(Blast.status.RUNNING);Blast.Ui.addMessage("execution started","info");null==Blast.Interpreter&&(Blast.highlightPause=!1,Blast.Interpreter=new Interpreter(Blast.latestCode,initApi),Blast.runner_=function(){if(Blast.Interpreter)try{Blast.Interrupted?setTimeout(Blast.runner_,5):Blast.Interpreter.step()?setTimeout(Blast.runner_,5):Blast.States.Interpreter||0<Blast.eventInWorkspace.length||(Blast.removeDeviceHandlers(),Blast.resetUi(Blast.status.READY),Blast.Ui.addMessage("execution completed",
"info"),Blast.resetInterpreter())}catch(a){Blast.throwError(a),Blast.Ui.setStatus(Blast.status.ERROR),Blast.removeDeviceHandlers(),Blast.resetInterpreter(),console.error(a)}},Blast.runner_())};Blast.stopJS=function(){Blast.removeDeviceHandlers();Blast.resetInterpreter();Blast.States.Interpreter&&(clearTimeout(Blast.States.runner_),Blast.States.runner_=null);Blast.resetUi(Blast.status.STOPPED)};
Blast.throwError=function(a){a||(a="Error executing program - See console for details.");Blast.Ui.addMessage(a,"error");Blast.Ui.setStatus(Blast.status.ERROR);Blast.Ui.addMessage("Execution stopped","info");Blast.removeDeviceHandlers();Blast.resetInterpreter()};Blast.handleFetchErrors=function(a,b){a.ok||(b?Blast.throwError(b):Blast.throwError("Error processing HTTP Request."));return a};window.addEventListener("load",Blast.init);Blast.Storage={};Blast.Storage.HTTPREQUEST_ERROR="There was a problem with the request.\n";Blast.Storage.LINK_ALERT="Load your blocks with this link:\n\n%1";Blast.Storage.NOT_FOUND_ERROR='Sorry, couldn\'t find "%1".';Blast.Storage.XML_ERROR="Could not load your saved file.\nPerhaps it was created with a different version of Blast?";Blast.Storage.filename="BLAST.xml";
Blast.Storage.link=function(a){console.log(a);var b=Blast.workspace,c=Blockly.Xml.workspaceToDom(b,!0);1==b.getTopBlocks(!1).length&&c.querySelector&&(b=c.querySelector("block"))&&(b.removeAttribute("x"),b.removeAttribute("y"));c=Blast.Storage.removeDeviceId_(c);c=Blockly.Xml.domToPrettyText(c);!0===a?(c=new Blob([c],{type:"text/xml"}),saveAs(c,Blast.Storage.filename)):((a=document.getElementById("loadWorkspace-input").value)&&0!=a.length||(a="storage/"+Blast.Storage.generatePath()),c=Blockly.Xml.domToText(c),
Blast.Storage.saveXML_(a,c))};
Blast.Storage.removeDeviceId_=function(a){var b=a.querySelectorAll("block");b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=c.value;var d=c.getAttribute("type");if("things_webBluetooth"==d||"things_webHID"==d)if(c=c.firstElementChild){var e=c.textContent,g="things_webBluetooth"==d?Blast.Things.getWebBluetoothDevices():Blast.Things.getWebHIDDevices();d=void 0;g=$jscomp.makeIterator(g);for(var f=g.next();!f.done;f=g.next()){f=$jscomp.makeIterator(f.value);var l=f.next().value;if(f.next().value===
e){d=l;break}}c.textContent=d}}return a};Blast.Storage.saveXML_=function(a,b){Blockly.hideChaff();fetch(a,{method:"PUT",body:b}).then(function(c){c.ok?(location.hash=a,Blockly.alert(Blast.Storage.LINK_ALERT.replace("%1",window.location.href))):Blast.throwError(Blast.Storage.HTTPREQUEST_ERROR)})};
Blast.Storage.load=function(){var a=document.getElementById("loadWorkspace-input").value;if(""==a)Blockly.alert("Enter a URI first.");else{var b=a.split("/").pop();-1<b.indexOf(".")&&(Blast.Storage.filename=b);Blast.Storage.retrieveXML_(a)}};
Blast.Storage.loadXMLFromFile=function(a){return new Promise(function(b,c){var d=a.target.files[0].name;-1<d.indexOf(".")&&(Blast.Storage.filename=d);d=new FileReader;d.onload=function(e){Blast.Storage.loadXML(e.target.result);b()};d.onerror=function(e){c(e.target.error)};d.readAsText(a.target.files[0])})};
Blast.Storage.retrieveXML_=function(a){return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){Blockly.hideChaff();Blast.resetInterpreter();Blast.resetUi(Blast.status.READY);fetch(a).then(function(c){if(c.ok)return c.text();Blast.throwError(Blast.Storage.NOT_FOUND_ERROR.replace("%1",a))}).then(Blast.Storage.loadXML);b.jumpToEnd()})};
Blast.Storage.loadXML=function(a){Blast.workspace.clear();try{var b=Blockly.Xml.textToDom(a)}catch(c){Blast.throwError(Blast.Storage.XML_ERROR+"\nXML: "+b);return}b.querySelector('block[type="things_webBluetooth"]')||b.querySelector('block[type="things_webHID"]')?(Blast.Storage.generatePairButtons(b),document.getElementById("rcModal")&&(document.getElementById("rcModal").style.display="block")):(Blockly.Xml.domToWorkspace(b,Blast.workspace),Blast.Storage.monitorChanges_(Blast.workspace))};
Blast.Storage.generatePairButtons=function(a){window.location.href.includes("mobile")?(window.app.openReconnectDialog(),this.generatePairButtonsMobile_(a)):this.generatePairButtonsDesktop_(a)};
Blast.Storage.generatePairButtonsDesktop_=function(a){for(var b=a.querySelectorAll("block"),c=document.getElementById("rc-tbody");c.firstChild;)c.removeChild(c.firstChild);var d=[],e={};b=$jscomp.makeIterator(b);for(var g=b.next();!g.done;e={$jscomp$loop$prop$type$48:e.$jscomp$loop$prop$type$48,$jscomp$loop$prop$name$49:e.$jscomp$loop$prop$name$49,$jscomp$loop$prop$block$50:e.$jscomp$loop$prop$block$50},g=b.next()){e.$jscomp$loop$prop$block$50=g.value;e.$jscomp$loop$prop$type$48=e.$jscomp$loop$prop$block$50.getAttribute("type");
if("things_webBluetooth"==e.$jscomp$loop$prop$type$48||"things_webHID"==e.$jscomp$loop$prop$type$48){e.$jscomp$loop$prop$name$49=e.$jscomp$loop$prop$block$50.firstElementChild.textContent;if(d.includes(e.$jscomp$loop$prop$name$49))continue;g=document.createElement("tr");var f=document.createElement("td");f.appendChild(document.createTextNode(e.$jscomp$loop$prop$name$49));var l=document.createElement("td"),h=document.createElement("input");h.setAttribute("type","button");h.setAttribute("id","pairButton-"+
e.$jscomp$loop$prop$name$49);h.setAttribute("value","Pair");var k=document.createElement("td"),m=document.createElement("span");m.setAttribute("id","pairStatus-"+e.$jscomp$loop$prop$name$49);m.innerHTML="&#x2718;";m.style.color="red";m.style.fontSize="20px";m.style.fontWeight="bold";m.style.marginRight="10px";k.appendChild(m);h.addEventListener("click",function(n){return function(){var p,q;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){if(1==r.nextAddress)return"things_webBluetooth"!=
n.$jscomp$loop$prop$type$48?("things_webHID"==n.$jscomp$loop$prop$type$48&&(p=[],navigator.hid.requestDevice({filters:p}).then(function(t){0===t.length&&Blast.throwError("Connection failed or cancelled by User.");var u=Date.now().toString(36)+Math.random().toString(36).substr(2);Blast.Things.webHidDevices.set(u,t[0]);Blast.Things.addWebHidDevice(u,n.$jscomp$loop$prop$name$49);document.getElementById("pairStatus-"+n.$jscomp$loop$prop$name$49).innerHTML="&#x2714;";document.getElementById("pairStatus-"+
n.$jscomp$loop$prop$name$49).style.color="green";n.$jscomp$loop$prop$block$50.firstElementChild.textContent=u;console.log(n.$jscomp$loop$prop$block$50);Blast.Storage.allConnectedDesktop_()&&(document.getElementById("rc-done").disabled=!1,document.getElementById("rc-done").addEventListener("click",function(){return Blast.Storage.reconnectDoneHandler_(a)}))}).catch(function(t){wHidLog("Argh! "+t)})),r.jumpTo(0)):r.yield(Blast.Bluetooth.requestDevice(),3);q=r.yieldResult;document.getElementById("pairStatus-"+
n.$jscomp$loop$prop$name$49).innerHTML="&#x2714;";document.getElementById("pairStatus-"+n.$jscomp$loop$prop$name$49).style.color="green";n.$jscomp$loop$prop$block$50.firstElementChild.textContent=q.id;Blast.Storage.allConnectedDesktop_()&&(document.getElementById("rc-done").disabled=!1,document.getElementById("rc-done").addEventListener("click",function(){return Blast.Storage.reconnectDoneHandler_(a)}));r.jumpToEnd()})}}(e));l.appendChild(h);g.appendChild(f);g.appendChild(l);g.appendChild(k);c.appendChild(g);
d.push(e.$jscomp$loop$prop$name$49)}document.getElementById("rc-cancel").addEventListener("click",function(){return Blast.Storage.reconnectCancelHandler_()})}};
Blast.Storage.generatePairButtonsMobile_=function(a){for(var b=a.querySelectorAll("block"),c=document.getElementById("rc-list");c.firstChild;)c.removeChild(c.firstChild);var d=[],e={};b=$jscomp.makeIterator(b);for(var g=b.next();!g.done;e={$jscomp$loop$prop$type$52:e.$jscomp$loop$prop$type$52,$jscomp$loop$prop$name$53:e.$jscomp$loop$prop$name$53,$jscomp$loop$prop$block$54:e.$jscomp$loop$prop$block$54},g=b.next())if(e.$jscomp$loop$prop$block$54=g.value,e.$jscomp$loop$prop$type$52=e.$jscomp$loop$prop$block$54.getAttribute("type"),
"things_webBluetooth"==e.$jscomp$loop$prop$type$52||"things_webHID"==e.$jscomp$loop$prop$type$52)if(e.$jscomp$loop$prop$name$53=e.$jscomp$loop$prop$block$54.firstElementChild.textContent,!d.includes(e.$jscomp$loop$prop$name$53)){g=document.createElement("li");g.setAttribute("id","rc-item-"+e.$jscomp$loop$prop$name$53);g.setAttribute("class","mdc-list-item");var f=document.createElement("span");f.setAttribute("id","rc-icon-"+e.$jscomp$loop$prop$name$53);f.setAttribute("class","mdc-list-item__graphic material-icons");
f.setAttribute("aria-hidden","true");f.innerHTML="things_webBluetooth"==e.$jscomp$loop$prop$type$52?"bluetooth_disabled":"usb_off";g.appendChild(f);f=document.createElement("span");f.setAttribute("class","mdc-list-item__text");var l=document.createElement("span");l.setAttribute("class","mdc-list-item__primary-text");l.innerHTML=e.$jscomp$loop$prop$name$53;f.appendChild(l);l=document.createElement("span");l.setAttribute("class","mdc-list-item__secondary-text");l.setAttribute("id","rc-status-"+e.$jscomp$loop$prop$name$53);
l.innerHTML="disconnected";f.appendChild(l);g.appendChild(f);g.addEventListener("click",function(h){return function(){var k,m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(1==n.nextAddress)return"things_webBluetooth"!=h.$jscomp$loop$prop$type$52?("things_webHID"==h.$jscomp$loop$prop$type$52&&(k=[],navigator.hid.requestDevice({filters:k}).then(function(p){0===p.length&&Blast.throwError("Connection failed or cancelled by User.");var q=Date.now().toString(36)+Math.random().toString(36).substr(2);
Blast.Things.webHidDevices.set(q,p[0]);Blast.Things.addWebHidDevice(q,"");document.getElementById("rc-status-"+h.$jscomp$loop$prop$name$53).innerHTML="connected";document.getElementById("rc-icon-"+h.$jscomp$loop$prop$name$53).innerHTML="usb";document.getElementById("rc-icon-"+h.$jscomp$loop$prop$name$53).style.color="#0d30b1";h.$jscomp$loop$prop$block$54.firstElementChild.textContent=q;Blast.Storage.allConnectedDesktop_()&&(document.getElementById("rc-done").disabled=!1,document.getElementById("rc-done").addEventListener("click",
function(){return Blast.Storage.reconnectDoneHandler_(a)}))}).catch(function(p){wHidLog("Argh! "+p)})),n.jumpTo(0)):n.yield(Blast.Bluetooth.requestDevice(),3);m=n.yieldResult;Blast.Things.addWebBluetoothDevice(m.id,h.$jscomp$loop$prop$name$53);document.getElementById("rc-status-"+h.$jscomp$loop$prop$name$53).innerHTML="connected";document.getElementById("rc-icon-"+h.$jscomp$loop$prop$name$53).innerHTML="bluetooth";document.getElementById("rc-icon-"+h.$jscomp$loop$prop$name$53).style.color="#0d30b1";
h.$jscomp$loop$prop$block$54.firstElementChild.textContent=m.id;Blast.Storage.allConnectedMobile_()&&(document.getElementById("rc-done").disabled=!1,document.getElementById("rc-done").addEventListener("click",function(){return Blast.Storage.reconnectDoneHandler_(a)}));n.jumpToEnd()})}}(e));c.appendChild(g);d.push(e.$jscomp$loop$prop$name$53)}window.app.initLists()};
Blast.Storage.allConnectedDesktop_=function(){var a=document.getElementById("rc-tbody").querySelectorAll("tr");a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())if(b=document.getElementById("pairStatus-"+b.value.firstElementChild.textContent),console.log(b.innerHTML),"\u2718"==b.innerHTML)return!1;return!0};
Blast.Storage.allConnectedMobile_=function(){var a=document.getElementById("rc-list").querySelectorAll("[id=rc-status-]");a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())if("disconnected"==document.getElementById("rc-status-"+b.value.textContent).innerHTML)return!1;return!0};
Blast.Storage.reconnectDoneHandler_=function(a){window.location.href.includes("mobile")?document.getElementById("rc-dialog").style.display="none":document.getElementById("rcModal").style.display="none";Blockly.Xml.domToWorkspace(a,Blast.workspace);Blast.Storage.monitorChanges_(Blast.workspace)};Blast.Storage.reconnectCancelHandler_=function(){document.getElementById("rcModal").style.display="none"};
Blast.Storage.monitorChanges_=function(a){function b(){var e=Blockly.Xml.workspaceToDom(a);e=Blockly.Xml.domToText(e);d!=e&&(window.location.hash="",a.removeChangeListener(b))}var c=Blockly.Xml.workspaceToDom(a),d=Blockly.Xml.domToText(c);a.addChangeListener(b)};Blast.Storage.generatePath=function(){for(var a=[],b=0;12>b;b++)a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random())));return a.join("")};
window.addEventListener("load",function(){var a=window.location.hash;if(a){a=a.substring(1);try{Blast.Storage.retrieveXML_(a)}catch(b){console.log(b)}}});Blast.Things={};Blast.Things.webBluetoothDevices=new Map;Blast.Things.webHidNames=new Map;Blast.Things.webHidDevices=new Map;
Blast.Things.flyoutCategory=function(a){var b=[],c=document.createElement("label");c.setAttribute("text","WebBluetooth Blocks");b.push(c);c=document.createElement("button");c.setAttribute("text","connect via webBluetooth");c.setAttribute("callbackKey","CREATE_WEBBLUETOOTH");a.registerButtonCallback("CREATE_WEBBLUETOOTH",function(g){Blast.Things.createWebBluetoothButtonHandler()});b.push(c);c=Blast.Things.flyoutCategoryBlocksWB(a);b=b.concat(c);c=document.createElement("label");c.setAttribute("text",
"WebHID Blocks");b.push(c);c=document.createElement("button");c.setAttribute("text","connect via webHID");c.setAttribute("callbackKey","CREATE_WEBHID");a.registerButtonCallback("CREATE_WEBHID",function(g){Blast.Things.createWebHidButtonHandler()});b.push(c);a=Blast.Things.flyoutCategoryBlocksWHid(a);b=b.concat(a);a=document.createElement("label");a.setAttribute("text","additional identifiers");b.push(a);a=Blockly.utils.xml.createElement("block");a.setAttribute("type","uri");b.push(a);a=document.createElement("label");
a.setAttribute("text","example audio URIs");b.push(a);a=$jscomp.makeIterator(["https://studio.code.org/blockly/media/skins/dance/win.mp3","https://studio.code.org/blockly/media/click.mp3","https://upload.wikimedia.org/wikipedia/commons/2/25/243020_plasterbrain_game-start.ogg","https://upload.wikimedia.org/wikipedia/commons/d/d9/Wilhelm_Scream.ogg"]);for(c=a.next();!c.done;c=a.next()){c=c.value;var d=Blockly.utils.xml.createElement("block");d.setAttribute("type","uri");var e=Blockly.utils.xml.createElement("field");
e.setAttribute("name","URI");e.textContent=c;d.appendChild(e);b.push(d)}return b};Blast.Things.flyoutCategoryBlocksWHid=function(){var a=[];if(0<Blast.Things.webHidDevices.size&&Blockly.Blocks.things_webHID){var b=Blockly.utils.xml.createElement("block");b.setAttribute("type","things_webHID");b.setAttribute("gap",8);a.push(b)}return a};
Blast.Things.flyoutCategoryBlocksWB=function(){var a=[];if(0<Blast.Things.webBluetoothDevices.size&&Blockly.Blocks.things_webBluetooth){var b=Blockly.utils.xml.createElement("block");b.setAttribute("type","things_webBluetooth");b.setAttribute("gap",8);a.push(b)}return a};
Blast.Things.getWebBluetoothDevices=function(){var a=[].concat($jscomp.arrayFromIterable(Blast.Things.webBluetoothDevices.keys())).sort();if(0===a.legnth)return[];var b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;var d=Blast.Things.webBluetoothDevices.get(c);b.push([c,d])}return b};
Blast.Things.getWebHIDDevices=function(){var a=[].concat($jscomp.arrayFromIterable(Blast.Things.webHidNames.keys())).sort();if(0===a.legnth)return[];var b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;var d=Blast.Things.webHidNames.get(c);b.push([c,d])}return b};Blast.Things.createWebBluetoothButtonHandler=function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){return a.yield(Blast.Bluetooth.requestDevice(),0)})};
Blast.Things.addWebBluetoothDevice=function(a,b){var c=function(d,e){Blockly.Variables.promptName("Pair successful! Now give your device a name.",d,function(g){if(g)if(Blast.Things.webBluetoothDevices.has(g)){var f="Name %1 already exists".replace("%1",g);Blockly.alert(f,function(){c(g,e)})}else Blast.Things.webBluetoothDevices.set(g,e);else Blockly.alert("Name cannot be empty",function(){c(g,e)})})};c(b,a)};
Blast.Things.createWebHidButtonHandler=function(){navigator.hid.requestDevice({filters:[]}).then(function(a){if(0===a.length)Blast.throwError("Connection failed or cancelled by User.");else{var b=Date.now().toString(36)+Math.random().toString(36).substr(2);Blast.Things.webHidDevices.set(b,a[0]);Blast.Things.addWebHidDevice(b,"");Blast.workspace.refreshToolboxSelection()}}).catch(function(a){Blast.throwError(a)})};
Blast.Things.addWebHidDevice=function(a,b){var c=function(d,e){Blockly.Variables.promptName("Connection established! Now give your device a name.",d,function(g){if(g)if(Blast.Things.webHidNames.has(g)){var f="Name %1 already exists".replace("%1",g);Blockly.alert(f,function(){c(g,e)})}else Blast.Things.webHidNames.set(g,e);else Blockly.alert("Name cannot be empty",function(){c(g,e)})})};c(b,a)};Blast.Bluetooth={};Blast.Bluetooth.optionalServices=[];Blast.Bluetooth.scanBlocks=[];Blast.Bluetooth.LEScanResults={};Blast.Bluetooth.isLEScanRunning=!1;Blast.Bluetooth.eventListeners=[];
Blast.Bluetooth.requestDevice=function(a,b){var c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){navigator.bluetooth&&(a||(a={acceptAllDevices:!0},a.optionalServices=Blast.Bluetooth.optionalServices),c=b||device.name,navigator.bluetooth.requestDevice(a).then(function(e){Blast.Things.addWebBluetoothDevice(e.id,c);Blast.workspace.refreshToolboxSelection();return e}).catch(function(e){Blast.throwError(e)}));d.jumpToEnd()})};
Blast.Bluetooth.getDeviceById=function(a){var b,c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return g.yield(navigator.bluetooth.getDevices(),2);b=g.yieldResult;c=$jscomp.makeIterator(b);for(d=c.next();!d.done;d=c.next())if(e=d.value,e.id==a)return g.return(e);Blast.throwError("Bluetooth device "+a+" wasn't found in paired devices.");g.jumpToEnd()})};
Blast.Bluetooth.connect=function(a){var b,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){switch(d.nextAddress){case 1:return d.setCatchFinallyBlocks(2),d.yield(Blast.Bluetooth.getDeviceById(a),4);case 4:return b=d.yieldResult,d.yield(b.gatt.connect(),5);case 5:return d.return(d.yieldResult);case 2:c=d.enterCatchBlock(),Blast.throwError("Error connecting to Bluetooth device "+a),console.error(c),d.jumpToEnd()}})};
Blast.Bluetooth.disconnect=function(a){var b,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){switch(d.nextAddress){case 1:return d.setCatchFinallyBlocks(2),d.yield(Blast.Bluetooth.getDeviceById(a),4);case 4:return b=d.yieldResult,d.yield(b.gatt.disconnect(),5);case 5:return d.return(d.yieldResult);case 2:c=d.enterCatchBlock(),Blast.throwError("Error disconnecting from Bluetooth device "+a),console.error(c),d.jumpToEnd()}})};
Blast.Bluetooth.gatt_writeWithoutResponse=function(a,b,c,d){function e(h){h=h.replace(/^0x/,"");0!=h.length%2&&(h="0"+h);var k=h.match(/[G-Z\s]/i);k&&console.log("WARNING: found non-hex characters",k);h=h.match(/[\dA-F]{2}/gi).map(function(m){return parseInt(m,16)});return(new Uint8Array(h)).buffer}var g,f,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){switch(h.nextAddress){case 1:return h.yield(Blast.Bluetooth.connect(a,b),2);case 2:return g=h.yieldResult,h.yield(g.getPrimaryService(b),
3);case 3:return f=h.yieldResult,h.yield(f.getCharacteristic(c),4);case 4:return l=h.yieldResult,d=e(d),h.yield(l.writeValueWithoutResponse(d),0)}})};
Blast.Bluetooth.gatt_read=function(a,b,c){var d,e,g,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:return l.setCatchFinallyBlocks(2),l.yield(Blast.Bluetooth.connect(a,b),4);case 4:return d=l.yieldResult,l.yield(d.getPrimaryService(b),5);case 5:return e=l.yieldResult,l.yield(e.getCharacteristic(c),6);case 6:return g=l.yieldResult,l.yield(g.readValue(),7);case 7:return l.return(l.yieldResult);case 2:f=l.enterCatchBlock(),Blast.throwError("Error reading from Bluetooth device "+
a),console.error(f),l.jumpToEnd()}})};Blast.Bluetooth.gatt_read_text=function(a,b,c){var d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return g.yield(Blast.Bluetooth.gatt_read(a,b,c),2);d=g.yieldResult;e=(new TextDecoder).decode(d);return g.return(e)})};
Blast.Bluetooth.gatt_read_number=function(a,b,c){var d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return g.yield(Blast.Bluetooth.gatt_read(a,b,c),2);d=g.yieldResult;e=(new DataView(d)).getUint8(0);return g.return(e)})};
Blast.Bluetooth.gatt_read_hex=function(a,b,c){var d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress)return g.yield(Blast.Bluetooth.gatt_read(a,b,c),2);d=g.yieldResult;e=(new Uint8Array(d)).reduce(function(f,l){return f+("0"+l.toString(16)).slice(-2)},"");return g.return(e)})};
Blast.Bluetooth.startLEScan=function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){if(Blast.Bluetooth.isLEScanRunning)return a.return();Blast.Bluetooth.cacheLEScanResults();Blast.Bluetooth.isLEScanRunning=!0;Blockly.alert("Please click allow on the LE Scan prompt now, then close this dialog.",navigator.bluetooth.requestLEScan({acceptAllAdvertisements:!0,keepRepeatedDevices:!0}));setTimeout(Blast.Bluetooth.stopLEScan,3E4);a.jumpToEnd()})};
Blast.Bluetooth.stopLEScan=function(){Blast.Bluetooth.isLEScanRunning&&(navigator.bluetooth.stopLEScan(),Blast.Bluetooth.isLEScanRunning=!1)};Blast.Bluetooth.cacheLEScanResults=function(){Blast.Bluetooth.addEventListener("advertisementreceived",function(a){var b=a.device.id;Blast.Bluetooth.LEScanResults[b]||(Blast.Bluetooth.LEScanResults[b]=[]);Blast.Bluetooth.LEScanResults[b].unshift(a)})};
Blast.Bluetooth.addEventListener=function(a,b){Blast.Bluetooth.eventListeners.push([a,b]);navigator.bluetooth.addEventListener(a,b)};Blast.Bluetooth.removeEventListener=function(a,b){var c=Blast.Bluetooth.eventListeners.findIndex(function(d){return d[0]===a&&d[1]===b});-1!==c&&Blast.Bluetooth.eventListeners.splice(c,1);navigator.bluetooth.removeEventListener(a,b)};
Blast.Bluetooth.tearDown=function(){Blast.Bluetooth.isLEScanRunning&&(Blast.Bluetooth.isLEScanRunning=!1);if(Blast.Bluetooth.eventListeners)for(var a=$jscomp.makeIterator(Blast.Bluetooth.eventListeners),b=a.next();!b.done;b=a.next())b=b.value,Blast.Bluetooth.removeEventListener(b[0],b[1]);Blast.Bluetooth.LEScanResults={}};function initApi(a,b){Blockly.JavaScript.addReservedWords("highlightBlock","eventChecker");var c=function(e){e=e?e.toString():"";return Blast.highlightBlock(e)};a.setProperty(b,"highlightBlock",a.createNativeFunction(c));c=function(e){Blast.Interrupted=e};a.setProperty(b,"setInterrupt",a.createNativeFunction(c));c=$jscomp.makeIterator(Blast.apiFunctions);for(var d=c.next();!d.done;d=c.next())d=d.value,a.setProperty(b,d[0],a.createNativeFunction(d[1]));c=$jscomp.makeIterator(Blast.asyncApiFunctions);
for(d=c.next();!d.done;d=c.next())d=d.value,a.setProperty(b,d[0],a.createAsyncFunction(d[1]));c=function(e,g){return Blast.States.eventChecker(e,g)};a.setProperty(b,"eventChecker",a.createNativeFunction(c));a.setProperty(b,"startEventChecker",a.createNativeFunction(function(){return Blast.States.startEventChecker()}));c=function(e){return prompt(e)};a.setProperty(b,"prompt",a.createNativeFunction(c))};Blockly.JavaScript.repeat=Blockly.JavaScript.controls_repeat_ext;Blockly.JavaScript.while_until=Blockly.JavaScript.controls_whileUntil;Blockly.JavaScript["for"]=Blockly.JavaScript.controls_for;Blockly.JavaScript.break_continue=Blockly.JavaScript.controls_flow_statements;Blockly.JavaScript.conditional_statement=Blockly.JavaScript.controls_if;Blockly.JavaScript.wait_seconds=function(a){return"waitForSeconds("+Number(a.getFieldValue("SECONDS"))+");\n"};
var waitForSeconds=function(a,b){setTimeout(b,1E3*a)};Blast.asyncApiFunctions.push(["waitForSeconds",waitForSeconds]);Blockly.JavaScript.state_definition=function(a){return null};
Blockly.JavaScript.event=function(a){var b=a.getFieldValue("entersExits"),c=a.getFieldValue("NAME"),d=Blockly.JavaScript.statementToCode(a,"statements");Blockly.JavaScript.definitions_.eventChecker="startEventChecker()";if(c=Blast.States.getDefinition(c,Blast.workspace))c=Blockly.JavaScript.valueToCode(c,"state_condition",Blockly.JavaScript.ORDER_NONE),Blast.States.addEventCode(a.id,'if(eventChecker("'+a.id+'", '+(("ENTERS"==b?"":"!")+c)+")) {\n        setInterrupt(true);\n        "+d+" \n        setInterrupt(false);\n      }");
return null};Blockly.JavaScript.uri=function(a){return[Blockly.JavaScript.quote_(a.getFieldValue("URI")),Blockly.JavaScript.ORDER_NONE]};Blockly.JavaScript.mac=function(a){return[Blockly.JavaScript.quote_(a.getFieldValue("MAC")),Blockly.JavaScript.ORDER_NONE]};Blockly.JavaScript.number_value=Blockly.JavaScript.math_number;Blockly.JavaScript.number_infinity=function(a){return[Infinity,Blockly.JavaScript.ORDER_NONE]};
Blockly.JavaScript.number_arithmetic=function(a){var b={ADD:[" + ",Blockly.JavaScript.ORDER_ADDITION],MINUS:[" - ",Blockly.JavaScript.ORDER_SUBTRACTION],MULTIPLY:[" * ",Blockly.JavaScript.ORDER_MULTIPLICATION],DIVIDE:[" / ",Blockly.JavaScript.ORDER_DIVISION],MODULO:[" % ",Blockly.JavaScript.ORDER_DIVISION],POWER:[null,Blockly.JavaScript.ORDER_NONE]}[a.getFieldValue("OP")],c=b[0];b=b[1];var d=Blockly.JavaScript.valueToCode(a,"A",b)||"0";a=Blockly.JavaScript.valueToCode(a,"B",b)||"0";return c?[d+c+
a,b]:["Math.pow("+d+", "+a+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.JavaScript.number_random=function(a){var b=Blockly.JavaScript.valueToCode(a,"FROM",Blockly.JavaScript.ORDER_NONE)||"0";a=Blockly.JavaScript.valueToCode(a,"TO",Blockly.JavaScript.ORDER_NONE)||"0";return["numberRandom("+b+", "+a+")",Blockly.JavaScript.ORDER_NONE]};
Blockly.JavaScript.number_modulo=function(a){var b=Blockly.JavaScript.valueToCode(a,"DIVIDEND",Blockly.JavaScript.ORDER_MODULUS)||"0";a=Blockly.JavaScript.valueToCode(a,"DIVISOR",Blockly.JavaScript.ORDER_MODULUS)||"0";return[b+" % "+a,Blockly.JavaScript.ORDER_MODULUS]};var numberRandom=function(a,b){if(a>b){var c=a;a=b;b=c}return Math.floor(Math.random()*(b-a+1)+a)};Blast.asyncApiFunctions.push(["numberRandom",numberRandom]);Blockly.JavaScript.string=Blockly.JavaScript.text;Blockly.JavaScript.string_join=Blockly.JavaScript.text_join;Blockly.JavaScript.string_length=Blockly.JavaScript.text_length;Blockly.JavaScript.string_indexOf=Blockly.JavaScript.text_indexOf;Blockly.JavaScript.string_charAt=Blockly.JavaScript.text_charAt;Blockly.JavaScript.string_getSubstring=Blockly.JavaScript.text_getSubstring;Blockly.JavaScript.string_changeCase=Blockly.JavaScript.text_changeCase;Blockly.JavaScript.string_replace=Blockly.JavaScript.text_replace;
Blockly.JavaScript.string_showPrompt=Blockly.JavaScript.text_prompt;Blockly.JavaScript.things_webBluetooth=function(a){return[Blockly.JavaScript.quote_(a.getFieldValue("id")),Blockly.JavaScript.ORDER_NONE]};Blockly.JavaScript.things_webHID=function(a){return[Blockly.JavaScript.quote_(a.getFieldValue("id")),Blockly.JavaScript.ORDER_NONE]};Blockly.Blocks.repeat=Blockly.Blocks.controls_repeat_ext;Blockly.Blocks.while_until=Blockly.Blocks.controls_whileUntil;Blockly.Blocks["for"]=Blockly.Blocks.controls_for;Blockly.Blocks.break_continue=Blockly.Blocks.controls_flow_statements;Blockly.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.LOOP_TYPES.push("repeat","while_until","for");
Blockly.Blocks.conditional_statement={init:function(){this.appendValueInput("IF0").appendField("%{BKY_CONTROLS_IF_MSG_IF}").setCheck("Boolean");this.appendStatementInput("DO0").appendField("%{BKY_CONTROLS_IF_MSG_THEN}");this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setHelpUrl("%{BKY_CONTROLS_IF_HELPURL}");this.setColour(120);this.setMutator(new Blockly.Mutator(["controls_if_elseif","controls_if_else"]));this.setTooltip(function(){if(this.elseifCount_||this.elseCount_){if(!this.elseifCount_&&
this.elseCount_)return Blockly.Msg.CONTROLS_IF_TOOLTIP_2;if(this.elseifCount_&&!this.elseCount_)return Blockly.Msg.CONTROLS_IF_TOOLTIP_3;if(this.elseifCount_&&this.elseCount_)return Blockly.Msg.CONTROLS_IF_TOOLTIP_4}else return Blockly.Msg.CONTROLS_IF_TOOLTIP_1;return""}.bind(this))},elseifCount_:0,elseCount_:0,suppressPrefixSuffix:!0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;var a=Blockly.utils.xml.createElement("mutation");this.elseifCount_&&a.setAttribute("elseif",
this.elseifCount_);this.elseCount_&&a.setAttribute("else",1);return a},domToMutation:function(a){this.elseifCount_=parseInt(a.getAttribute("elseif"),10)||0;this.elseCount_=parseInt(a.getAttribute("else"),10)||0;this.rebuildShape_()},decompose:function(a){var b=a.newBlock("controls_if_if");b.initSvg();for(var c=b.nextConnection,d=1;d<=this.elseifCount_;d++){var e=a.newBlock("controls_if_elseif");e.initSvg();c.connect(e.previousConnection);c=e.nextConnection}this.elseCount_&&(a=a.newBlock("controls_if_else"),
a.initSvg(),c.connect(a.previousConnection));return b},compose:function(a){a=a.nextConnection.targetBlock();this.elseCount_=this.elseifCount_=0;for(var b=[null],c=[null],d=null;a&&!a.isInsertionMarker();){switch(a.type){case "controls_if_elseif":this.elseifCount_++;b.push(a.valueConnection_);c.push(a.statementConnection_);break;case "controls_if_else":this.elseCount_++;d=a.statementConnection_;break;default:throw new TypeError("Unknown block type: "+a.type);}a=a.nextConnection&&a.nextConnection.targetBlock()}this.updateShape_();
this.reconnectChildBlocks_(b,c,d)},saveConnections:function(a){a=a.nextConnection.targetBlock();for(var b=1;a;){switch(a.type){case "controls_if_elseif":var c=this.getInput("IF"+b),d=this.getInput("DO"+b);a.valueConnection_=c&&c.connection.targetConnection;a.statementConnection_=d&&d.connection.targetConnection;b++;break;case "controls_if_else":d=this.getInput("ELSE");a.statementConnection_=d&&d.connection.targetConnection;break;default:throw new TypeError("Unknown block type: "+a.type);}a=a.nextConnection&&
a.nextConnection.targetBlock()}},rebuildShape_:function(){var a=[null],b=[null],c=null;this.getInput("ELSE")&&(c=this.getInput("ELSE").connection.targetConnection);for(var d=1;this.getInput("IF"+d);){var e=this.getInput("IF"+d),g=this.getInput("DO"+d);a.push(e.connection.targetConnection);b.push(g.connection.targetConnection);d++}this.updateShape_();this.reconnectChildBlocks_(a,b,c)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var a=1;this.getInput("IF"+a);)this.removeInput("IF"+
a),this.removeInput("DO"+a),a++;for(a=1;a<=this.elseifCount_;a++)this.appendValueInput("IF"+a).setCheck("Boolean").appendField(Blockly.Msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+a).appendField(Blockly.Msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(Blockly.Msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(a,b,c){for(var d=1;d<=this.elseifCount_;d++)Blockly.Mutator.reconnect(a[d],this,"IF"+d),Blockly.Mutator.reconnect(b[d],this,"DO"+
d);Blockly.Mutator.reconnect(c,this,"ELSE")}};Blockly.Blocks.wait_seconds={init:function(){this.appendDummyInput().appendField("wait").appendField(new Blockly.FieldNumber("1, 0, 600"),"SECONDS").appendField("seconds");this.setColour(120);this.setTooltip("Wait x seconds before executing the next block.");this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setHelpUrl("")}};
Blockly.Blocks.controls_if_if={init:function(){this.appendDummyInput().appendField("%{BKY_CONTROLS_IF_IF_TITLE_IF}");this.setNextStatement(!0,null);this.contextMenu=!1;this.setColour(120);this.setTooltip("%{BKY_CONTROLS_IF_IF_TOOLTIP}")}};Blockly.Blocks.controls_if_elseif={init:function(){this.appendDummyInput().appendField("%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}");this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.contextMenu=!1;this.setColour(120);this.setTooltip("%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}")}};
Blockly.Blocks.controls_if_else={init:function(){this.appendDummyInput().appendField("%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}");this.setPreviousStatement(!0,null);this.contextMenu=!1;this.setColour(120);this.setTooltip("%{BKY_CONTROLS_IF_ELSE_TOOLTIP}")}};Blockly.Blocks.state_definition={init:function(){var a=Blast.States.findLegalName("",this);a=new Blockly.FieldTextInput(a,Blast.States.rename);a.setSpellcheck(!1);this.appendValueInput("state_condition").setCheck("Boolean").appendField("define state").appendField(a,"NAME");this.setColour(180);this.setTooltip("");this.setHelpUrl("")},getStateDef:function(){var a=this.getFieldValue("state_condition");return[this.getFieldValue("NAME"),a]},getConditions:function(){return this.getFieldValue("state_condition")}};
Blockly.Blocks.event={init:function(){this.appendDummyInput().appendField("when blast").appendField(new Blockly.FieldDropdown([["enters","ENTERS"],["exits","EXITS"]]),"entersExits").appendField("state").appendField(new Blockly.FieldLabelSerializable(""),"NAME");this.appendStatementInput("statements").setCheck(null);this.setColour(180);this.setTooltip("");this.setHelpUrl("")},getStateName:function(){return this.getFieldValue("NAME")},renameState:function(a,b){Blockly.Names.equals(a,this.getStateName())&&
this.setFieldValue(b,"NAME")},mutationToDom:function(){var a=Blockly.utils.xml.createElement("mutation");a.setAttribute("name",this.getStateName());return a},domToMutation:function(a){a=a.getAttribute("name");this.renameState(this.getStateName(),a)},onchange:function(a){if(this.workspace&&!this.workspace.isFlyout&&a.recordUndo)if(a.type==Blockly.Events.BLOCK_CREATE&&-1!=a.ids.indexOf(this.id)){var b=this.getStateName();(b=Blast.States.getDefinition(b,this.workspace))&&b.type!=this.defType_&&(b=null);
if(!b){Blockly.Events.setGroup(a.group);a=Blockly.utils.xml.createElement("xml");b=Blockly.utils.xml.createElement("block");b.setAttribute("type",this.defType_);var c=this.getRelativeToSurfaceXY(),d=c.y+2*Blockly.SNAP_RADIUS;b.setAttribute("x",c.x+Blockly.SNAP_RADIUS*(this.RTL?-1:1));b.setAttribute("y",d);c=this.mutationToDom();b.appendChild(c);c=Blockly.utils.xml.createElement("field");c.setAttribute("name","NAME");d=this.getStateName();d||(d=Blast.States.findLegalName("",this),this.renameState("",
d));c.appendChild(Blockly.utils.xml.createTextNode(d));b.appendChild(c);a.appendChild(b);Blockly.Xml.domToWorkspace(a,this.workspace);Blockly.Events.setGroup(!1)}}else a.type==Blockly.Events.BLOCK_DELETE?(b=this.getStateName(),Blast.States.getDefinition(b,this.workspace)||(Blockly.Events.setGroup(a.group),this.dispose(!0),Blockly.Events.setGroup(!1))):a.type==Blockly.Events.CHANGE&&"disabled"==a.element&&(b=this.getStateName(),(b=Blast.States.getDefinition(b,this.workspace))&&b.id==a.blockId&&((b=
Blockly.Events.getGroup())&&console.log("Saw an existing group while responding to a definition change"),Blockly.Events.setGroup(a.group),a.newValue?(this.previousEnabledState_=this.isEnabled(),this.setEnabled(!1)):this.setEnabled(this.previousEnabledState_),Blockly.Events.setGroup(b)))},defType_:"state_definition"};Blockly.Blocks.mac={init:function(){this.appendDummyInput().appendField("mac").appendField(new Blockly.FieldTextInput("deadbeef"),"MAC");this.setOutput(!0,"mac");this.setColour(60);this.setTooltip("");this.setHelpUrl("")}};Blockly.Blocks.uri={init:function(){this.appendDummyInput().appendField("URI").appendField(new Blockly.FieldTextInput("http://example.com"),"URI");this.setOutput(!0,"URI");this.setColour(60);this.setTooltip("");this.setHelpUrl("")}};Blockly.Blocks.number_value=Blockly.Blocks.math_number;Blockly.Blocks.number_random=Blockly.Blocks.math_random_int;Blockly.Blocks.number_arithmetic=Blockly.Blocks.math_arithmetic;Blockly.Blocks.number_modulo=Blockly.Blocks.math_modulo;Blockly.Blocks.number_infinity={init:function(){this.appendDummyInput().appendField("infinity");this.setOutput(!0,"Number");this.setColour(230);this.setTooltip("");this.setHelpUrl("")}};Blockly.Blocks.string=Blockly.Blocks.text;Blockly.Blocks.string_join=Blockly.Blocks.text_join;Blockly.Blocks.string_length=Blockly.Blocks.text_length;Blockly.Blocks.string_indexOf=Blockly.Blocks.text_indexOf;Blockly.Blocks.string_charAt=Blockly.Blocks.text_charAt;Blockly.Blocks.string_getSubstring=Blockly.Blocks.text_getSubstring;Blockly.Blocks.string_changeCase=Blockly.Blocks.text_changeCase;Blockly.Blocks.string_replace=Blockly.Blocks.text_replace;Blockly.Blocks.string_showPrompt=Blockly.Blocks.text_prompt_ext;
Blockly.Msg.TEXT_JOIN_TITLE_CREATEWITH="concatenate text";Blockly.Blocks.things_webBluetooth={init:function(){this.appendDummyInput().appendField("webBluetooth device").appendField(new Blockly.FieldDropdown(Blast.Things.getWebBluetoothDevices),"id");this.setOutput(!0,"Thing");this.setColour(60);this.setTooltip("");this.setHelpUrl("")}};
Blockly.Blocks.things_webHID={init:function(){this.appendDummyInput().appendField("HID device").appendField(new Blockly.FieldDropdown(Blast.Things.getWebHIDDevices),"id");this.setOutput(!0,"Thing");this.setColour(60);this.setTooltip("");this.setHelpUrl("")}};Blockly.Blocks.switch_lights_rgb={init:function(){this.appendValueInput("red").setCheck("Number").appendField("write color properties: red ");this.appendValueInput("green").setCheck("Number").appendField("green");this.appendValueInput("blue").setCheck("Number").appendField("blue");this.appendValueInput("thing").setCheck("Thing").appendField("to LED controller");this.setInputsInline(!0);this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setColour(255);this.setTooltip("Switches checked lights on and unchecked ones off.");
this.setHelpUrl("");this.firstTime=!0},onchange:function(){!this.isInFlyout&&this.firstTime&&this.rendered&&(this.firstTime=!1,navigator.bluetooth||(Blockly.alert("Webbluetooth is not supported by this browser.\n\n        Upgrade to Chrome version 85 or later and enable Experimental Web Platform features."),this.dispose()))}};var SWITCH_LIGHTS_RGB_XML='\n<block type="switch_lights_rgb">\n  <value name="red">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n  <value name="green">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n  <value name="blue">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n</block>';
Blast.Toolbox.addBlock("switch_lights_rgb","Properties",SWITCH_LIGHTS_RGB_XML);
Blockly.Blocks.switch_lights_ryg={init:function(){this.appendValueInput("red").setCheck("Number").appendField("write color properties: red ");this.appendValueInput("yellow").setCheck("Number").appendField("yellow");this.appendValueInput("green").setCheck("Number").appendField("green");this.appendValueInput("thing").setCheck("Thing").appendField("to LED controller");this.setInputsInline(!0);this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setColour(255);this.setTooltip("Swichtes checked lights on and unchecked ones off.");
this.setHelpUrl("");this.firstTime=!0},onchange:function(){!this.isInFlyout&&this.firstTime&&this.rendered&&(this.firstTime=!1,navigator.bluetooth||(Blockly.alert("Webbluetooth is not supported by this browser.\n\n        Upgrade to Chrome version 85 or later and enable Experimental Web Platform features."),this.dispose()))}};var SWITCH_LIGHTS_RYG_XML='\n<block type="switch_lights_ryg">\n  <value name="red">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n  <value name="yellow">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n  <value name="green">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n</block>';
Blast.Toolbox.addBlock("switch_lights_ryg","Properties",SWITCH_LIGHTS_RYG_XML);Blockly.JavaScript.switch_lights_rgb=function(a){var b=Blockly.JavaScript.valueToCode(a,"red",Blockly.JavaScript.ORDER_ATOMIC)||"0",c=Blockly.JavaScript.valueToCode(a,"green",Blockly.JavaScript.ORDER_ATOMIC)||"0",d=Blockly.JavaScript.valueToCode(a,"blue",Blockly.JavaScript.ORDER_ATOMIC)||"0";a=Blockly.JavaScript.valueToCode(a,"thing",Blockly.JavaScript.ORDER_NONE)||"null";b=parseInt(b).toString(16).padStart(2,"0");c=parseInt(c).toString(16).padStart(2,"0");d=parseInt(d).toString(16).padStart(2,"0");
return"switchLights("+a+", '"+("7e000503"+b+c+d+"00ef');\n")};
Blockly.JavaScript.switch_lights_ryg=function(a){var b=Blockly.JavaScript.valueToCode(a,"red",Blockly.JavaScript.ORDER_ATOMIC)||"0",c=Blockly.JavaScript.valueToCode(a,"yellow",Blockly.JavaScript.ORDER_ATOMIC)||"0",d=Blockly.JavaScript.valueToCode(a,"green",Blockly.JavaScript.ORDER_ATOMIC)||"0";a=Blockly.JavaScript.valueToCode(a,"thing",Blockly.JavaScript.ORDER_NONE)||"null";b=parseInt(b).toString(16).padStart(2,"0");c=parseInt(c).toString(16).padStart(2,"0");d=parseInt(d).toString(16).padStart(2,
"0");return"switchLights("+a+", '"+("7e000503"+b+d+c+"00ef');\n")};var LEDServiceUUID="0000fff0-0000-1000-8000-00805f9b34fb";Blast.Bluetooth.optionalServices.push(LEDServiceUUID);var switchLights=function(a,b,c){return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return a?d.yield(Blast.Bluetooth.gatt_writeWithoutResponse(a,LEDServiceUUID,"0000fff3-0000-1000-8000-00805f9b34fb",b),2):(Blast.throwError("No LED Controller is set."),c(),d.return());c();d.jumpToEnd()})};
Blast.asyncApiFunctions.push(["switchLights",switchLights]);Blockly.Blocks.http_request={init:function(){this.appendValueInput("uri").appendField("send HTTP request to URI").setCheck("URI");this.appendDummyInput().appendField("output").appendField(new Blockly.FieldDropdown([["status","status"],["response","body"]]),"OUTPUT");this.appendDummyInput().appendField("method").appendField(new Blockly.FieldDropdown([["GET","GET"],["PUT","PUT"],["POST","POST"],["DELETE","DELETE"]],this.httpRequestValidator),"METHOD");this.appendDummyInput().appendField("headers (comma separated)");
this.appendDummyInput().appendField(new Blockly.FieldTextInput('"Content-Type": "application/json", "Accept": "application/json"'),"HEADERS");this.setOutput(!0,"String");this.setTooltip("Invokes a HTTP request.");this.setColour(0)},httpRequestValidator:function(a){this.getSourceBlock().updateInputs(a);return a},updateInputs:function(a){this.removeInput("BODYINPUT",!0);"GET"!=a&&this.appendDummyInput("BODYINPUT").appendField("body").appendField(new Blockly.FieldMultilineInput('{\n     "object": {\n       "a": "b",\n       "c": "d",\n       "e": "f"\n     },\n     "array": [\n       1,\n       2\n     ],\n     "string": "Hello World"\n     }'),
"BODY")}};Blast.Toolbox.addBlock("http_request","Requests and Queries");Blockly.Blocks.sparql_query={init:function(){this.appendValueInput("uri").appendField("run SPARQL Query from URI").setCheck("URI");this.appendDummyInput().appendField(new Blockly.FieldMultilineInput("SELECT *\n       WHERE { \n         ?s ?p ?o\n       }"),"query");this.setInputsInline(!1);this.setColour(0);this.setOutput(!0,"table");this.setTooltip("Executes a sparql query")}};Blast.Toolbox.addBlock("sparql_query","Requests and Queries");
Blockly.Blocks.sparql_ask={init:function(){this.appendValueInput("uri").appendField("run SPARQL ASK Query from URI").setCheck("URI");this.appendDummyInput().appendField(new Blockly.FieldMultilineInput("PREFIX sosa: <http://www.w3.org/ns/sosa/>\n     ASK \n     WHERE {\n       ?node sosa:hasSimpleResult ?rssiValue \n       FILTER (?rssiValue > -40)\n     }"),"query");this.setInputsInline(!1);this.setOutput(!0,"Boolean");this.setTooltip("executes a sparql ASK query");this.setColour(0)}};
Blast.Toolbox.addBlock("sparql_ask","Requests and Queries");Blockly.Blocks.display_text={init:function(){this.appendValueInput("text").setCheck(["String","Number","Boolean","URI","Thing"]).appendField("display text:");this.setColour(0);this.setTooltip("Add text output to the container on the right.");this.setHelpUrl("");this.setPreviousStatement(!0,null);this.setNextStatement(!0,null)}};Blast.Toolbox.addBlock("display_text","Actions");
Blockly.Blocks.display_table={init:function(){this.appendValueInput("table").setCheck(["table"]).appendField("display table:");this.setColour(0);this.setTooltip("Add data output to the container on the right.");this.setHelpUrl("");this.setPreviousStatement(!0,null);this.setNextStatement(!0,null)}};Blast.Toolbox.addBlock("display_table","Actions");
Blockly.Blocks.play_audio={init:function(){this.appendValueInput("URI").appendField("play audio from URI").setCheck("URI");this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setColour(0);this.setTooltip("Plays an audio file from URI.");this.setHelpUrl("")}};Blast.Toolbox.addBlock("play_audio","Actions");
Blockly.Blocks.get_signal_strength_wb={init:function(){this.appendValueInput("Thing").setCheck("Thing").appendField("read signal-strength property of bluetooth device");this.setOutput(!0,["String","Number"]);this.setColour(255);this.setTooltip("Reads the strength of the signal (rssiValue property) sent by a ble device, measured at the at the BLAST client.");this.setHelpUrl("");this.firstTime=!0;this.requested=!1;this.deviceId=""},onchange:function(){!this.isInFlyout&&this.firstTime&&this.rendered&&
(this.firstTime=!1,navigator.bluetooth||(Blockly.alert("Webbluetooth is not supported by this browser.\n\n        Upgrade to Chrome version 85 or later."),this.dispose()))}};Blast.Toolbox.addBlock("get_signal_strength_wb","Properties");Blockly.JavaScript.http_request=function(a){var b=Blockly.JavaScript.valueToCode(a,"uri",Blockly.JavaScript.ORDER_NONE)||null,c=a.getFieldValue("METHOD"),d=a.getFieldValue("HEADERS"),e=a.getFieldValue("OUTPUT");a=JSON.stringify(a.getFieldValue("BODY"))||null;return["sendHttpRequest("+b+",'"+c+"', \n      '{"+d+"}', "+a+", '"+e+"')\n",Blockly.JavaScript.ORDER_NONE]};
var sendHttpRequest=function(a,b,c,d,e,g){var f,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){null!=a&&void 0!=a&&""!=a||Blast.throwError("URI input of HttpRequest blocks must not be empty");f=JSON.parse(c);l={method:b,headers:new Headers(f)};d&&(l.body=d);fetch(a,l).then(Blast.handleFetchErrors).then(function(k){var m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){if(1==n.nextAddress)return"status"==e&&g(k.status),n.yield(k.text(),2);m=n.yieldResult;g(m);n.jumpToEnd()})}).catch(function(k){Blast.throwError(k.message+
"\nSee console for details.")});h.jumpToEnd()})};Blast.asyncApiFunctions.push(["sendHttpRequest",sendHttpRequest]);Blockly.JavaScript.sparql_query=function(a){var b=a.getFieldValue("query");a=Blockly.JavaScript.valueToCode(a,"uri",Blockly.JavaScript.ORDER_NONE);b=b.replace(/"/g,'\\"').replace(/[\n\r]/g," ");return["urdfQueryWrapper("+a+", '"+b+"')",Blockly.JavaScript.ORDER_NONE]};
Blockly.JavaScript.sparql_ask=function(a){var b=a.getFieldValue("query");a=Blockly.JavaScript.valueToCode(a,"uri",Blockly.JavaScript.ORDER_NONE);b=b.replace(/"/g,'\\"').replace(/[\n\r]/g," ");return["urdfQueryWrapper("+a+', "'+b+'")',Blockly.JavaScript.ORDER_NONE]};
var urdfQueryWrapper=function(a,b,c){var d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){urdf.clear();d="\n FROM <"+a+">\n";b=b.slice(0,b.indexOf("WHERE"))+d+b.slice(b.indexOf("WHERE"));urdf.query(b).then(function(g){c(g)}).catch(function(g){console.error(g);Blast.throwError(g.message+"\nSee console for details.")});e.jumpToEnd()})};Blast.asyncApiFunctions.push(["urdfQueryWrapper",urdfQueryWrapper]);
Blockly.JavaScript.display_text=function(a){return"displayText("+(Blockly.JavaScript.valueToCode(a,"text",Blockly.JavaScript.ORDER_NONE)||"''")+");\n"};var displayText=function(a){Blast.Ui.addMessage(a)};Blast.apiFunctions.push(["displayText",displayText]);Blockly.JavaScript.display_table=function(a){return"displayTable("+Blockly.JavaScript.valueToCode(a,"table",Blockly.JavaScript.ORDER_NONE)+");\n"};
var displayTable=function(a){console.log(a);if(0==a.length)Blast.Ui.addMessage("empty table");else{var b=a.reduce(function(d,e){for(var g in e)-1===d.indexOf(g)&&d.push(g);return d},[]),c="<tr>";b.forEach(function(d){return c+="<th>"+d+"</th>"});c+="</tr>";a.forEach(function(d){c+="<tr>";b.forEach(function(e){return c+="<td>"+(d[e]?d[e].value:"")+"</td>"});c+="</tr>"});a=document.createElement("table");a.classList.add("output_table");a.innerHTML=c;Blast.Ui.addElementToOutputContainer(a)}};
Blast.apiFunctions.push(["displayTable",displayTable]);Blockly.JavaScript.play_audio=function(a){return"playAudio("+Blockly.JavaScript.valueToCode(a,"URI",Blockly.JavaScript.ORDER_NONE)+");\n"};
var playAudio=function(a,b){return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(new Promise(function(d,e){var g=new Audio(a);g.preload="auto";g.autoplay=!0;g.onerror=function(f){Blast.throwError("Error trying to play audio from \n"+a+"\n See console for details");console.error(f);e(f)};g.onended=d}),2);b();c.jumpToEnd()})};Blast.asyncApiFunctions.push(["playAudio",playAudio]);
Blockly.JavaScript.get_signal_strength_wb=function(a){return["getRSSIWb("+Blockly.JavaScript.valueToCode(a,"Thing",Blockly.JavaScript.ORDER_NONE)+")",Blockly.JavaScript.ORDER_NONE]};
var getRSSIWb=function(a,b){var c,d,e,g,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return l.yield(navigator.bluetooth.getDevices(),2);if(3!=l.nextAddress){c=l.yieldResult;d=null;e=$jscomp.makeIterator(c);for(g=e.next();!g.done;g=e.next())if(f=g.value,f.id===a){d=f;break}null==d&&Blast.throwError("Error pairing with Bluetooth device.");return l.yield(d.watchAdvertisements(),3)}d.addEventListener("advertisementreceived",function(h){return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){b(h.rssi);
k.jumpToEnd()})});l.jumpToEnd()})};Blast.asyncApiFunctions.push(["getRSSIWb",getRSSIWb]);Blockly.Blocks.huskylens_choose_algo={init:function(){this.appendValueInput("Thing").setCheck("Thing").appendField("write algorithm property").appendField(new Blockly.FieldDropdown([["Face Recognition","face_recognition"],["Object Tracking","object_tracking"],["Object Recognition","object_recognition"],["Line Tracking","line_tracking"],["Color Recognition","color_recognition"],["Tag Recognition","tag_recognition"],["Object Classification","object_classification"]]),"Algorithms").appendField("to Huskyduino");
this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setColour(255);this.setTooltip("Choose the algorithm of a HuskyDuino");this.setHelpUrl("")},onchange:function(){!this.isInFlyout&&this.firstTime&&this.rendered&&(this.firstTime=!1,navigator.bluetooth||(Blockly.alert("Webbluetooth is not supported by this browser.\n\n                Upgrade to Chrome version 85 or later."),this.dispose()))}};Blast.Toolbox.addBlock("huskylens_choose_algo","Properties");
Blockly.Blocks.huskylens_write_face_id={init:function(){this.appendValueInput("ID").setCheck("Number").appendField("write face ID property");this.appendValueInput("Thing").setCheck("Thing").appendField("to HuskyDuino");this.setInputsInline(!0);this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setColour(255);this.setTooltip("Sets the ID of the face currently on camera. ID shoud be a value between 1 and 255");this.setHelpUrl("")},onchange:function(){!this.isInFlyout&&this.firstTime&&
this.rendered&&(this.firstTime=!1,navigator.bluetooth||(Blockly.alert("Webbluetooth is not supported by this browser.\n\n                Upgrade to Chrome version 85 or later."),this.dispose()))}};var HUSKYLENS_WRITE_FACE_ID_XML='\n<block type="huskylens_write_face_id">\n  <value name="ID">\n    <block type="math_number">\n      <field name="NUM">1</field>\n    </block>\n  </value>\n</block>\n';Blast.Toolbox.addBlock("huskylens_write_face_id","Properties",HUSKYLENS_WRITE_FACE_ID_XML);
Blockly.Blocks.huskylens_write_forget_flag={init:function(){this.appendValueInput("ForgetFlag").setCheck("Boolean").appendField("write forget flag property");this.appendValueInput("Thing").setCheck("Thing").appendField("to HuskyDuino");this.setInputsInline(!0);this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setColour(255);this.setTooltip("forget all values of the currently selected algorithm");this.setHelpUrl("")},onchange:function(){!this.isInFlyout&&this.firstTime&&this.rendered&&
(this.firstTime=!1,navigator.bluetooth||(Blockly.alert("Webbluetooth is not supported by this browser.\n\n                Upgrade to Chrome version 85 or later."),this.dispose()))}};var HUSKYLENS_FORGET_FLAG_XML='\n<block type="huskylens_write_forget_flag">\n  <value name="ForgetFlag">\n    <block type="logic_boolean">\n      <field name="BOOL">TRUE</field>\n    </block>\n  </value>\n</block>\n';Blast.Toolbox.addBlock("huskylens_write_forget_flag","Properties",HUSKYLENS_FORGET_FLAG_XML);
Blockly.Blocks.huskylens_read_id={init:function(){this.appendValueInput("Thing").setCheck("Thing").appendField("read face IDs property of HuskyDuino");this.setOutput(!0,"String");this.setColour(255);this.setTooltip("returns up to 5 IDs of the faces currently visible to the HuskyLens");this.setHelpUrl("")},onchange:function(){!this.isInFlyout&&this.firstTime&&this.rendered&&(this.firstTime=!1,navigator.bluetooth||(Blockly.alert("Webbluetooth is not supported by this browser.\n\n                Upgrade to Chrome version 85 or later."),
this.dispose()))}};Blast.Toolbox.addBlock("huskylens_read_id","Properties");Blockly.JavaScript.huskylens_choose_algo=function(a){var b=a.getFieldValue("Algorithms");return"chooseAlgo("+Blockly.JavaScript.valueToCode(a,"Thing",Blockly.JavaScript.ORDER_ATOMIC)+", '"+{face_recognition:"0x01",object_tracking:"0x02",object_recognition:"0x03",line_tracking:"0x04",color_recognition:"0x05",tag_recognition:"0x06",object_classification:"0x07"}[b]+"');\n"};
Blockly.JavaScript.huskylens_write_face_id=function(a){var b="0x"+Blockly.JavaScript.valueToCode(a,"ID",Blockly.JavaScript.ORDER_ATOMIC).toString(16);return"learnID("+Blockly.JavaScript.valueToCode(a,"Thing",Blockly.JavaScript.ORDER_ATOMIC)+", '"+b+"');\n"};Blockly.JavaScript.huskylens_write_forget_flag=function(a){var b="TRUE"==a.getFieldValue("ForgetFlag");return"forgetAll("+Blockly.JavaScript.valueToCode(a,"Thing",Blockly.JavaScript.ORDER_ATOMIC)+", '0x"+(b?"01":"00")+"');\n"};
Blockly.JavaScript.huskylens_read_id=function(a){return["readID("+Blockly.JavaScript.valueToCode(a,"Thing",Blockly.JavaScript.ORDER_ATOMIC)+")",Blockly.JavaScript.ORDER_NONE]};var HuskyServiceUUID="5be35d20-f9b0-11eb-9a03-0242ac130003";Blast.Bluetooth.optionalServices.push(HuskyServiceUUID);
var chooseAlgo=function(a,b,c){return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(Blast.Bluetooth.gatt_writeWithoutResponse(a,HuskyServiceUUID,"5be35d26-f9b0-11eb-9a03-0242ac130003",b),2);c();d.jumpToEnd()})};Blast.asyncApiFunctions.push(["chooseAlgo",chooseAlgo]);
var learnID=function(a,b,c){return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(Blast.Bluetooth.gatt_writeWithoutResponse(a,HuskyServiceUUID,"5be35eca-f9b0-11eb-9a03-0242ac130003",b),2);c();d.jumpToEnd()})};Blast.asyncApiFunctions.push(["learnID",learnID]);
var forgetAll=function(a,b,c){return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(Blast.Bluetooth.gatt_writeWithoutResponse(a,HuskyServiceUUID,"5be361b8-f9b0-11eb-9a03-0242ac130003",b),2);c();d.jumpToEnd()})};Blast.asyncApiFunctions.push(["forgetAll",forgetAll]);
var readID=function(a,b){var c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(Blast.Bluetooth.gatt_read_text(a,HuskyServiceUUID,"5be3628a-f9b0-11eb-9a03-0242ac130003"),2);c=d.yieldResult;b(c);d.jumpToEnd()})};Blast.asyncApiFunctions.push(["readID",readID]);Blockly.Blocks.joycon_read_property={init:function(){this.appendValueInput("Thing").setCheck("Thing").appendField("read").appendField(new Blockly.FieldDropdown([["accelerometers","accelerometers"],["actual accelerometer","actualAccelerometer"],["actual gyroscope","actualGyroscope"],["actual orientation","actualOrientation"],["actual orientation quaternion","actualOrientationQuaternion"],["gyroscopes","gyroscopes"],["quaternion","quaternion"]],this.propertyValidator),"property").appendField("property of Nintendo JoyCon");
this.setInputsInline(!1);this.setOutput(!0,["String","Number"]);this.setColour(255);this.setTooltip("Reads a property of a Nintendo JoyCon controller.");this.setHelpUrl("");this.firstTime=!0},propertyValidator:function(a){this.getSourceBlock().updateInputs(a);return a},updateInputs:function(a){this.removeInput("propertySubValue",!0);this.removeInput("propertySubValue2",!0);this.removeInput("propertySubValue3",!0);"accelerometers"===a&&(this.appendDummyInput("propertySubValue").appendField("accelerometer").appendField(new Blockly.FieldDropdown([["0",
"0"],["1","1"],["2","2"]]),"propertySubValue"),this.appendDummyInput("propertySubValue2").appendField("axis").appendField(new Blockly.FieldDropdown([["x","x"],["y","y"],["z","z"]]),"propertySubValue2"));"actualAccelerometer"===a&&this.appendDummyInput("propertySubValue").appendField("axis").appendField(new Blockly.FieldDropdown([["x","x"],["y","y"],["z","z"]]),"propertySubValue");"actualGyroscope"===a&&(this.appendDummyInput("propertySubValue").appendField("unit").appendField(new Blockly.FieldDropdown([["rps",
"rps"],["dps","dps"]]),"propertySubValue"),this.appendDummyInput("propertySubValue2").appendField("axis").appendField(new Blockly.FieldDropdown([["x","x"],["y","y"],["z","z"]]),"propertySubValue2"));"actualOrientation"===a&&this.appendDummyInput("propertySubValue").appendField("degrees").appendField(new Blockly.FieldDropdown([["alpa","alpha"],["beta","beta"],["gamma","gamma"]]),"propertySubValue");"actualOrientationQuaternion"===a&&this.appendDummyInput("propertySubValue").appendField("degrees").appendField(new Blockly.FieldDropdown([["alpa",
"alpha"],["beta","beta"],["gamma","gamma"]]),"propertySubValue");"gyroscopes"===a&&(this.appendDummyInput("propertySubValue").appendField("gyroscope").appendField(new Blockly.FieldDropdown([["0","0"],["1","1"],["2","2"]]),"propertySubValue"),this.appendDummyInput("propertySubValue2").appendField("axis").appendField(new Blockly.FieldDropdown([["x","0"],["y","1"],["z","2"]]),"propertySubValue2"),this.appendDummyInput("propertySubValue3").appendField("unit").appendField(new Blockly.FieldDropdown([["dps",
"dps"],["rps","rps"]]),"propertySubValue3"));"quaternion"===a&&this.appendDummyInput("propertySubValue").appendField("axis").appendField(new Blockly.FieldDropdown([["w","w"],["x","x"],["y","y"],["z","z"]]),"propertySubValue")}};Blast.Toolbox.addBlock("joycon_read_property","Properties");Blockly.JavaScript.joycon_read_property=function(a){var b=a.getFieldValue("property"),c=a.getFieldValue("propertySubValue")||"",d=a.getFieldValue("propertySubValue2")||"",e=a.getFieldValue("propertySubValue3")||"";return["readJoyConProperty("+Blockly.JavaScript.valueToCode(a,"Thing",Blockly.JavaScript.ORDER_NONE)+", '"+b+"', '"+c+"', '"+d+"', '"+e+"')",Blockly.JavaScript.ORDER_NONE]};
var readJoyConProperty=function(a,b,c,d,e,g){var f,l,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:if(!a)return Blast.throwError("No Joy-Con block set."),g(),k.return();f=Blast.Things.webHidDevices.get(a);if(f.opened){k.jumpTo(2);break}k.setCatchFinallyBlocks(3);return k.yield(f.open(),5);case 5:k.leaveTryBlock(2);break;case 3:k.enterCatchBlock(),Blast.throwError("Failed to open device, your browser or OS probably doesn't support webHID.");case 2:if(1406!==
f.vendorId||8198!==f.productId)return Blast.throwError("The connected device is not a Joy-Con."),g(),k.return();8198===f.productId?l=new JoyConLeft(f):8199===f.productId&&(l=new JoyConRight(f));return k.yield(l.open(),6);case 6:return k.yield(l.enableStandardFullMode(),7);case 7:return k.yield(l.enableIMUMode(),8);case 8:h=function(m){var n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(p){n=m.detail;if(!n||!n.actualOrientation)return p.return();console.log(n);l.removeEventListener("hidinput",
h);""!==d?"accelerometers"===b?g(n[b][c][d].acc):"gyroscopes"===b?g(n[b][c][d][e]):g(n[b][c][d]):g(n[b][c]);p.jumpToEnd()})};if(l.eventListenerAttached){k.jumpTo(0);break}return k.yield(l.open(),10);case 10:return k.yield(l.enableStandardFullMode(),11);case 11:return k.yield(l.enableIMUMode(),12);case 12:return k.yield(l.enableVibration(),13);case 13:l.addEventListener("hidinput",h),l.eventListenerAttached=!0,k.jumpToEnd()}})};Blast.asyncApiFunctions.push(["readJoyConProperty",readJoyConProperty]);Blockly.Blocks.read_ruuvi_property={init:function(){this.appendValueInput("Thing").setCheck("Thing").appendField("read").appendField(new Blockly.FieldDropdown([["temperature","temperature"],["humidity","humidity"],["pressure","pressure"],["acceleration X","accelerationX"],["acceleration Y","accelerationY"],["acceleration Z","accelerationZ"],["battery voltage","batteryVoltage"],["txPower","txPower"],["movement counter","movementCounter"],["measurement sequence number","measurementSequenceNumber"]]),
"measurement").appendField("property of RuuviTag");this.setOutput(!0,["String","Number"]);this.setColour(255);this.setTooltip("Reads a property of a Ruuvi Tag.");this.setHelpUrl("");this.firstTime=!0},onchange:function(){!this.isInFlyout&&this.firstTime&&this.rendered&&(this.firstTime=!1,navigator.bluetooth||(Blockly.alert("Webbluetooth is not supported by this browser.\n\n        Upgrade to Chrome version 85 or later."),this.dispose()))}};Blast.Toolbox.addBlock("read_ruuvi_property","Properties");
Blast.Bluetooth.scanBlocks.push("read_ruuvi_property");Blockly.JavaScript.read_ruuvi_property=function(a){var b=a.getFieldValue("measurement");a=Blockly.JavaScript.valueToCode(a,"Thing",Blockly.JavaScript.ORDER_ATOMIC);return["getRuuviProperty('"+b+"', "+a+")",Blockly.JavaScript.ORDER_NONE]};
var getRuuviProperty=function(a,b,c){var d,e,g,f,l,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return d=function(m){var n={},p=m[0]&255,q=m[1]<<8|m[2]&255;32767<q&&(q-=65535);var r=((m[3]&255)<<8|m[4]&255)/400,t=((m[5]&255)<<8|m[6]&255)+5E4,u=(m[7]<<8|m[8]&255)/1E3,w=(m[9]<<8|m[10]&255)/1E3,x=(m[11]<<8|m[12]&255)/1E3,v=(m[13]&255)<<8|m[14]&255,y=m[15]&255;m=(m[16]&255)<<8|m[17]&255;n.destination_endpoint=p;n.temperature=q/200;n.humidity=r;n.pressure=t;n.accelerationX=
u;n.accelerationY=w;n.accelerationZ=x;n.batteryVoltage=(v>>>5)/1E3+1.6;n.txPower=2*(v&31)-40;n.movementCounter=y;n.measurementSequenceNumber=m;return n},e=function(m){if(30>m){var n=Blast.Bluetooth.LEScanResults[b];if(n){n=$jscomp.makeIterator(n);for(var p=n.next();!p.done;p=n.next())if((p=p.value.manufacturerData.get(1177))&&5==p.getUint8(0))return p}return new Promise(function(q){setTimeout(function(){q(e(m+1))},1E3)})}},Blast.Bluetooth.startLEScan(b),k.yield(e(0),2);(g=k.yieldResult)||Blast.throwError("Timed out. No BLE advertising data found for "+
b);f=[];for(l=0;l<g.byteLength;l++)f.push("0x"+("00"+g.getUint8(l).toString(16)).slice(-2));h=d(f);c(h[a]);k.jumpToEnd()})};Blast.asyncApiFunctions.push(["getRuuviProperty",getRuuviProperty]);Blockly.Blocks.streamdeck_buttons={init:function(){this.appendValueInput("id").setCheck("Thing").appendField("Streamdeck mini");this.appendDummyInput().appendField("on button press:");this.appendDummyInput().setAlign(Blockly.ALIGN_CENTRE).appendField(new Blockly.FieldCheckbox("FALSE"),"button1").appendField(new Blockly.FieldCheckbox("FALSE"),"button2").appendField(new Blockly.FieldCheckbox("FALSE"),"button3");this.appendDummyInput().setAlign(Blockly.ALIGN_CENTRE).appendField(new Blockly.FieldCheckbox("FALSE"),
"button4").appendField(new Blockly.FieldCheckbox("FALSE"),"button5").appendField(new Blockly.FieldCheckbox("FALSE"),"button6");this.appendDummyInput().appendField("do");this.appendStatementInput("statements").setCheck(null);this.setColour(180);this.setTooltip("");this.setHelpUrl("");this.requested=!1;this.keyState=Array(6).fill(!1)},addEvent:function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){Blast.eventInWorkspace.push(a.id);Blast.workspace.addChangeListener(function(c){return a.onDispose(c)});
b.jumpToEnd()})},onchange:function(){this.isInFlyout||this.requested||!this.rendered||this.addEvent()},onDispose:function(a){a.type===Blockly.Events.BLOCK_DELETE&&a.type===Blockly.Events.BLOCK_DELETE&&-1!==a.ids.indexOf(this.id)&&this.removeFromEvents()},removeFromEvents:function(){var a=Blast.eventInWorkspace.indexOf(this.id);-1!==a&&Blast.eventInWorkspace.splice(a,1)}};Blast.Toolbox.addBlock("streamdeck_buttons","States and Events");Blockly.JavaScript.streamdeck_buttons=function(a){var b="TRUE"==a.getFieldValue("button1")?1:0,c="TRUE"==a.getFieldValue("button2")?1:0,d="TRUE"==a.getFieldValue("button3")?1:0,e="TRUE"==a.getFieldValue("button4")?1:0,g="TRUE"==a.getFieldValue("button5")?1:0,f="TRUE"==a.getFieldValue("button6")?1:0,l=Blockly.JavaScript.valueToCode(a,"id",Blockly.JavaScript.ORDER_NONE);b=[b,c,d,e,g,f];a=Blockly.JavaScript.quote_(Blockly.JavaScript.statementToCode(a,"statements"));return"handleStreamdeck("+l+", ["+
b+"], "+a+");\n"};
var handleStreamdeck=function(a,b,c){var d,e,g,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:if(!a)return Blast.throwError("No streamdeck block set."),callback(),l.return();d="inputreport";e=Blast.Things.webHidDevices.get(a);if(e.opened){l.jumpTo(2);break}l.setCatchFinallyBlocks(3);return l.yield(e.open(),5);case 5:l.leaveTryBlock(2);break;case 3:g=l.enterCatchBlock(),console.error(g),Blast.throwError("Failed to open device, your browser or OS probably doesn't support webHID.");case 2:if(4057!=
e.vendorId)return Blast.throwError("The connected device is not a Stream Deck."),l.return();f=function(h){if(1===h.reportId&&(h=new Int8Array(h.data.buffer),h=Array.from(h).slice(0,6),b=b.toString().split(",").map(Number),h.every(function(n,p){return n===b[p]}))){Blast.Interrupted=!0;var k=new Interpreter("");k.stateStack[0].scope=Blast.Interpreter.globalScope;k.appendCode(c);var m=function(){try{k.step()?setTimeout(m,5):Blast.Interrupted=!1}catch(n){Blockly.alert("Error executing program:\n%e".replace("%e",
n)),Blast.Ui.setStatus(Blast.status.ERROR),Blast.resetInterpreter(),console.error(n)}};m()}};Blast.deviceEventHandlers.push({device:e,type:d,fn:f});e.addEventListener(d,f);l.jumpToEnd()}})};Blast.apiFunctions.push(["handleStreamdeck",handleStreamdeck]);Blockly.Blocks.mirobot_pickup={init:function(){this.appendDummyInput().appendField("Robot-arm, pick up").appendField(new Blockly.FieldDropdown([["blue","BLUE"],["red","RED"],["yellow","YELLOW"],["green","GREEN"]]),"box").appendField("box");this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setColour(0);this.setTooltip("Invokes pick-up action for the selected box.");this.setHelpUrl("")}};Blast.Toolbox.addBlock("mirobot_pickup","actions");Blockly.JavaScript.mirobot_pickup=function(a){return"mirobotPickUpBox("+Blockly.JavaScript.quote_(a.getFieldValue("box").toLowerCase())+");\n"};
var mirobotPickUp=function(a,b){var c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){c="https://bot.rapidthings.eu/thing/action/grab_"+a.toLowerCase();d={"Content-Type":"application/json",Accept:"application/json"};e={method:"POST",headers:new Headers(d)};fetch(c,e).then(Blast.handleFetchErrors).then(function(f){b(f.status)}).catch(function(f){Blast.throwError(f.message+"\nSee console for details.")});g.jumpToEnd()})};Blast.asyncApiFunctions.push(["mirobot_pickup",mirobotPickUp]);Blockly.Blocks.blinkstick_set_colors={init:function(){this.appendValueInput("index").setCheck("Number").appendField("write color properties of LED");this.appendValueInput("red").appendField("red");this.appendValueInput("green").setCheck("Number").appendField("green");this.appendValueInput("blue").setCheck("Number").appendField("blue");this.appendValueInput("thing").setCheck("Thing").appendField("to BlinkStick");this.setInputsInline(!0);this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);
this.setColour(255);this.setTooltip("Set the color properties of a tulogic BlinkStick.");this.setHelpUrl("https://www.blinkstick.com/")}};var BLINKSTICK_SET_COLORS_XML='\n<block type="blinkstick_set_colors">\n  <value name="index">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n  <value name="red">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n  <value name="green">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n  <value name="blue">\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n  </value>\n</block>\n';
Blast.Toolbox.addBlock("blinkstick_set_colors","Properties",BLINKSTICK_SET_COLORS_XML);Blockly.JavaScript.blinkstick_set_colors=function(a){var b=Blockly.JavaScript.valueToCode(a,"red",Blockly.JavaScript.ORDER_ATOMIC)||"0",c=Blockly.JavaScript.valueToCode(a,"green",Blockly.JavaScript.ORDER_ATOMIC)||"0",d=Blockly.JavaScript.valueToCode(a,"blue",Blockly.JavaScript.ORDER_ATOMIC)||"0",e=Blockly.JavaScript.valueToCode(a,"index",Blockly.JavaScript.ORDER_ATOMIC)||"0";return"blinkstickSetColors("+(Blockly.JavaScript.valueToCode(a,"thing",Blockly.JavaScript.ORDER_ATOMIC)||"''")+", "+e+", "+
b+", "+c+", "+d+")\n;"};
var blinkstickSetColors=function(a,b,c,d,e,g){var f,l,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:if(0>b||7<b)return Blast.throwError("BlinkStick index must be between 0 and 7."),g(),k.return();if(!a)return Blast.throwError("No BlinkStick block set."),g(),k.return();f=Blast.Things.webHidDevices.get(a);if(f.opened){k.jumpTo(2);break}k.setCatchFinallyBlocks(3);return k.yield(f.open(),5);case 5:k.leaveTryBlock(2);break;case 3:k.enterCatchBlock(),Blast.throwError("Failed to open device, your browser or OS probably doesn't support webHID.");
case 2:if(8352!==f.vendorId||16869!==f.productId)return Blast.throwError("The connected device is not a BlinkStick."),g(),k.return();l=Int8Array.from([5,b,c,d,e]);h=function(m){var n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(p){if(1==p.nextAddress)return p.setCatchFinallyBlocks(2),p.yield(f.sendFeatureReport(5,l),4);if(2!=p.nextAddress)return p.leaveTryBlock(0);n=p.enterCatchBlock();return 0<m?p.yield(h(--m),0):(console.error(n),Blast.throwError("Failed to set BlinkStick colors, please check its connection."),
p.jumpTo(0))})};return k.yield(h(5),6);case 6:g(),k.jumpToEnd()}})};Blast.asyncApiFunctions.push(["blinkstickSetColors",blinkstickSetColors]);Blockly.Blocks.text_to_speech={init:function(){this.appendValueInput("text").appendField("Text to Speech").setCheck("String");this.setPreviousStatement(!0,null);this.setNextStatement(!0,null);this.setColour(0);this.setTooltip("");this.setHelpUrl("")}};Blast.Toolbox.addBlock("text_to_speech","actions");
Blockly.Blocks.web_speech={init:function(){this.appendDummyInput().appendField("speech to text");this.setOutput(!0,"String");this.setColour(0);this.setTooltip("outputs speech command from microphone as a string");this.setHelpUrl("");this.firstTime=!0;this.recognition=null},onchange:function(){!this.isInFlyout&&this.firstTime&&this.rendered&&(this.firstTime=!1,"webkitSpeechRecognition"in window?this.recognition=new webkitSpeechRecognition:(Blockly.alert('Web Speech API is not supported by this browser.\n        Upgrade to <a href="//www.google.com/chrome">Chrome</a>\n        version 25 or later.'),
this.dispose()))}};Blast.Toolbox.addBlock("web_speech","actions");Blockly.JavaScript.text_to_speech=function(a){return"textToSpeech("+Blockly.JavaScript.valueToCode(a,"text",Blockly.JavaScript.ORDER_ATOMIC)+");\n"};Blockly.JavaScript.web_speech=function(a){return["webSpeech('"+a.id+"')",Blockly.JavaScript.ORDER_NONE]};
var webSpeech=function(a,b){var c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){c=Blast.workspace.getBlockById(a);d=c.recognition;d.continuous=!1;d.lang="en-US";e="";d.onresult=function(f){for(var l=f.resultIndex;l<f.results.length;++l)f.results[l].isFinal&&(e+=f.results[l][0].transcript)};d.onend=function(){b(e)};d.start();g.jumpToEnd()})};Blast.asyncApiFunctions.push(["webSpeech",webSpeech]);
var textToSpeech=function(a,b){var c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return c=new SpeechSynthesisUtterance,c.text=a,window.speechSynthesis.speak(c),d.yield(new Promise(function(e){c.onend=e}),2);b();d.jumpToEnd()})};Blast.asyncApiFunctions.push(["textToSpeech",textToSpeech]);
