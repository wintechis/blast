<!DOCTYPE html>
<html lang="en" xml:lang="en">

<head>
  <meta content="text/html;" charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BLAST - Block applications for things</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="apple-touch-icon" sizes="57x57" href="media/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="media/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="media/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="media/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="media/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="media/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="media/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="media/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="media/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="media/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="media/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="media/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="media/favicon-16x16.png">
  <meta http-equiv=”Content-Security-Policy” content=”upgrade-insecure-requests”>
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <script>
    // redirect to HTTPS
    if (location.protocol != 'https:') {
      location.replace(`https:${location.href.substring(location.protocol.length)}`);
    }

    // check if chrome on windows is used with experimental features enabled,
    // if not, redirect to prerquisite page.
    let urlParams = new URLSearchParams(window.location.search);
    let skipCheck = false;
    if (urlParams.has('skipCheck')) {
      skipCheck = true;
    }
    const isChrome = !!window.chrome;
    const isWindows = navigator.platform.toLowerCase().indexOf('win') >= 0;
    const isAndroid = navigator.userAgent.toLowerCase().indexOf('android') >= 0;
    const supportsWebBluetooth = 'bluetooth' in navigator;
    if (!skipCheck && !(isChrome && (isWindows || isAndroid) && supportsWebBluetooth)) {
       location.href = `prerequisites.html`;
    }

    // redirect mobile users to mobile site.
    // mobile check for older browsers
    const legacyIsMobileCheck = function () {
      if (navigator.userAgent.match(/Android/i) ||
      navigator.userAgent.match(/webOS/i) ||
      navigator.userAgent.match(/iPhone/i) ||
      navigator.userAgent.match(/iPad/i) ||
      navigator.userAgent.match(/iPod/i) ||
      navigator.userAgent.match(/BlackBerry/i) ||
      navigator.userAgent.match(/Windows Phone/i)) {
        return true;
    }
    return false;
    }

    // mobile check for newer browsers
    const uaDataIsMobile = window.navigator.userAgentData?.mobile

    // if either mobile check is true, redirect to mobile site.
    const isMobile = typeof uaDataIsMobile === 'boolean'
      ? uaDataIsMobile
      : legacyIsMobileCheck()
    if (isMobile) {
      window.location.replace("mobile/index.html");
    }
  </script>
  <!-- blast libraries -->
  <script src="dist/app.js?v=b096213"></script>
</head>

<body>
  <table id="outerTable">
    <tr id="headerTr">
      <td colspan=2>
        <table width="100%">
          <tr id="tabRow">
            <td id="tab_workspace" class="tabon">Workspace</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_javascript" class="taboff">JavaScript</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_pseudo" class="taboff">Pseudo Code</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_xml" class="taboff">XML</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_deviceLogs" class="taboff">Device Logs</td>
            <td class="tabmin">&nbsp;</td>
            <td id="inputs_td" class="tabmin">
              <input list="samples" type="text" id="loadWorkspace-input"
                placeholder="save to or load from URI">
              <datalist id="samples">
                <option value="samples/eval.xml"></option>
                <option value="samples/events.xml"></option>
                <option value="samples/gamble.xml"></option>
                <option value="samples/helloWorld.xml"></option>
                <option value="samples/playAudio.xml"></option>
                <option value="samples/requests.xml"></option>
                <option value="samples/rgbLights.xml"></option>
                <option value="samples/ruuviProperties.xml"></option>
                <option value="samples/signalStrength.xml"></option>
                <option value="samples/sounds.xml"></option>
                <option value="samples/streamdeck.xml"></option>
                <option value="samples/toggle.xml"></option>
                <option value="samples/webSpeech.xml"></option>
                <option value="samples/useCases/anti-theft-alarm.xml"></option>
                <option value="samples/useCases/timer.xml"></option>
              </datalist>
            </td>
            <td class="tabmin">
              <button id="UriLoadButton" title="load workspace">
                <span class="icon material-icons">
                  cloud_download
                  </span>
              </button>
              <button id="UriSaveButton" title="save workspace">
                <span class="icon material-icons">
                  cloud_upload
                  </span>
              </button>
            </td>
            <td class="tabmin">&nbsp;</td>
            <td class="tabmin">
              <input type="file" id="file-selector" accept=".xml">
              <button id="saveButton" title="save workspace">
                <span class="icon material-icons">
                  save
                  </span>
              </button>
            </td>
            <td class="tabmax">
              <span id="statusContainer">ready</span>
              <button id="runButton" class="primary" title="Run the program">
                <span class="material-icons">
                  play_arrow
                </span>
              </button>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td id="content_area">
      </td>
      <td id="output_area">
        <div id="msgOutputContainer">
          <button id="clearOutputButton" title="clear output">
            <span class="material-icons">
              clear
            </span>
          </button>
        </div>
      </td>
    </tr>
  </table>

    <!-- Reconnect Modal -->
    <div id="rcModal" class="modal">
      <div class="modal-content">
        <span id ="rcClose" class="close">&times;</span>
        <h1>Please connect these devices to load the Program:</h1>
        <hr>
        <div class="row" id="reconnect-row">
          <div class="col">
            <table id="rc-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Pair</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="rc-tbody">
              </tbody>
            </table>
            <br>
            <input type="button" id="rc-cancel" value="cancel">
            <input type="button" id="rc-done" value="done" disabled>
          </div>
        </div>
      </div>
    </div>

    <!-- connect device chooser -->
    <div id="connect-modal" class="modal">
      <div class="modal-content">
        <span id ="connect-close" class="close">&times;</span>
        <h1>Please select a device from the list below</h1>
        <hr>
        <div class="row" id="connect-row">
          <div class="col">
            <table id="connect-table">
              <thead>
                <tr>
                  <th>Device Type</th>
                  <th>Action</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="connect-tbody">
              </tbody>
            </table>
            <br>
            <input type="button" id="connect-done" value="done">
          </div>
        </div>
      </div>
    </div>

    <!-- Debug info modal -->
    <div id="debugModal" class="modal">
      <div class="modal-content">
        <span id ="debugClose" class="close">&times;</span>
        <h1>Debug Info:</h1>
        Please attach these Information to any issue you are reporting on <a href="https://github.com/wintechis/blast/issues">GitHub</a>:
        <hr>
        <div class="row" id="debug-row">
          <div class="col">
            <table id="debug-table">
              <tbody id="debug-tbody">
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  <div id="content_workspace" class="content"></div>
  <pre id="content_javascript" class="content prettyprint lang-js"></pre>
  <pre id="content_pseudo" class="content"></pre>
  <textarea id="content_xml" class="content" wrap="off"></textarea>
  <div id="content_deviceLogs" class="content">
    <button id="clearDeviceLogsButton" title="clear logs">
      <span class="material-icons">
        clear
      </span>
    </button>
  </div>
  <div id="devInfo">
    <span id="version">version: #{version}</span>
    <span style="display: block">&nbsp;</span>
    <span id="devMode">toggle dev mode
      <label class="switch">
        <input type="checkbox" id="devModeSwitch">
        <span class="slider round"></span>
      </label>
    </span>
  </div>
</body>
<script>
  /**
   * Bluetooth device chooser
   */
  const connectModal = document.getElementById('connect-modal');
  const connectModalClose = document.getElementById('connect-close');

  connectModalClose.onclick = function () {
    connectModal.style.display = 'none';
  }

  // When the user clicks anywhere outside of the modal, close it
  window.addEventListener('click', (event) => {
    if (event.target == connectModal) {
      connectModal.style.display = 'none';
    }
  });

  const connectModalDone = document.getElementById('connect-done');
  connectModalDone.onclick = function () {
    connectModal.style.display = 'none';
  }

  /**
   * Reconnect modal methods
   */
  const rcClose = document.getElementById("rcClose");
  const rcModal = document.getElementById("rcModal");

  rcClose.onclick = function () {
    rcModal.style.display = "none";
  }

  // When the user clicks anywhere outside of the modal, close it
  window.addEventListener('click', (event) => {
    if (event.target == rcModal) {
      rcModal.style.display = "none";
    }
  });

  /**
   * Debug info modal methods
   */
  const debugClose = document.getElementById("debugClose");
  const debugModal = document.getElementById("debugModal");

  debugClose.onclick = function () {
    debugModal.style.display = "none";
  }

  // When the user clicks anywhere outside of the modal, close it
  window.addEventListener('click', (event) => {
    if (event.target == debugModal) {
      debugModal.style.display = "none";
    }
  });

</script>
</html>
