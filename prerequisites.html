<!DOCTYPE html>
<html lang="en" xml:lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BLAST - Prerequisites</title>
    <style>
        code {
        padding: .2em .4em;
        margin: 0;
        font-size: 85%;
        background-color: var(--color-neutral-muted);
        border-radius: 6px;
        }
        table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        }

        td, th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
        }

        tr:nth-child(even) {
        background-color: #dddddd;
        }
    </style>
</head>
<body>
    <h1>Your platform is not fully supported.</h1>
    Below is a list of the missing prerequisites:
    <br>
    <br>
    <table>
        <thead>
            <tr>
                <th>Feature</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="prerequisites">
        </tbody>
    </table>
    <br>
    <br>
    <a href="index.html?skipCheck=true">Click here to continue anyway.</a>
    <br>
    <br>
    <div>
        <h2>How to fix this:</h2>
        <div id="fix-using-google-chrome">
            <h3>Using Google Chrome:</h3>
            <p>
                Access this page using Google Chrome:
                <a href="https://www.google.com/chrome/">Download Chrome</a>
            </p>
        </div>
        <div id="fix-on-windows-or-android">
            <h3>On Windows or Android:</h3>
            <p>
                Access this page using Chrome on Windows 10 or Android.
            </p>
        </div>
        <div id="fix-experimental-web-platform-features-enabled">
            <h3>Experimental Web Platform Features enabled:</h3>
            <p>
                To enable them, go to
                <code>chrome://flags/#enable-experimental-web-platform-features</code>
                and click enable.
            </p>
        </div>
    </div>
    <script>
        // fill prerequisites table with url parameters
        const tBody = document.getElementById('prerequisites');
        const isChrome = !!window.chrome;
        const isWindows = navigator.platform.toLowerCase().indexOf('win') >= 0;
        const isAndroid = navigator.userAgent.toLowerCase().indexOf('android') >= 0;
        const supportsWebBluetooth = 'bluetooth' in navigator;
        const platform = new Map();
        platform.set('using Google Chrome', isChrome);
        platform.set('on Windows or Android', isWindows || isAndroid);
        platform.set('experimental web platform features enabled', supportsWebBluetooth);

        if(isChrome && (isWindows || isAndroid) && supportsWebBluetooth) {
            // redirect to index.html
            window.location.href = 'index.html';
        }
            
        for (const [key, value] of platform) {
            // fill table with missing prerequisites
            const tr = document.createElement('tr');
            const tdFeature = document.createElement('td');
            const tdStatus = document.createElement('td');
            tdFeature.innerText = key;
            tdStatus.innerText = value === true ? '✅' : '❌';
            tr.appendChild(tdFeature);
            tr.appendChild(tdStatus);
            tBody.appendChild(tr);
            // show fix instructions
            const container = document.getElementById(`fix-${key.toLowerCase().replace(/ /g, '-')}`);
            container.style.display = value === true ? 'none' : 'block';
        }


    </script>
</body>