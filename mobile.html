<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <link rel="stylesheet" href="mobile.css">
    <link rel="apple-touch-icon" sizes="57x57" href="media/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="media/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="media/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="media/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="media/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="media/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="media/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="media/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="media/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="media/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="media/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="media/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="media/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="manifest" href="site.webmanifest">
    <title>BLAST - Block applications for things</title>

    <!-- JS Interpreter -->
    <script src="js/lib/JSInterpreter/acorn.js"></script>
    <script src="js/lib/JSInterpreter/interpreter.js"></script>

    <!-- blockly with js generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/5.20210325.1/blockly_compressed.min.js"
        integrity="sha512-iqNC/BA2OwsMa0EMB4Xnxm7i+Y38C5j26CjgG/prCg74ILAJomPIIyp+I45hVfV9A50vnaGoh808fu6GaGAuHw=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/5.20210325.1/msg/en.min.js"
        integrity="sha512-CcZSuOhlsHqLLiF3M8hvMc8aWqTE36GEaE/cP7HMNOSZytGihNqhQxFzkXigYQp4psZWCVjEXY2oYFN4+vLAYg=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/5.20210325.1/blocks_compressed.min.js"
        integrity="sha512-2EDgchO+DLca8kTvZv5NGY57nB+fH3DelW4qIKEW94cUy+UpgHNdpO6GCSxUtGYuG6ny7f2fssqCIrlN3WrHvw=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/5.20210325.1/javascript_compressed.min.js"
        integrity="sha512-ATkMUjg1QwPS8AgpyN53xYVsIlqlYa8N3jxp0XYLRxdCXxzh1LmC+WmpilE/E9sFX1RVdxidf2bFI9O8Pl5bUw=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    </script>

    <!-- urdf -->
    <script src="js/lib/urdf/urdf-browser.js"></script>

    <!-- play/stop icons -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/svgxuse/1.2.6/svgxuse.min.js"
        integrity="sha512-yipBrwYdC4+gC3Rm6FY8KG+2xNTU+frQScGdqXFWanTQn9ZBRBNJ3R3vQ+7gkAxu2ilb5SuFer0DL+dNTTtyhg=="
        crossorigin="anonymous"></script>

    <!-- blast libraries -->
    <script src="js/blast.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="header">
            <span>
                <img src="media/android-icon-144x144.png" alt="BLAST Logo">
                BLAST - Block Applications for Things
            </span>
        </div>
        <div id="content" class="container">
            <div id="load">
                <p>Load from URI</p>
                <div class="input-group">
                    <input type="text" id="loadWorkspace-input" placeholder="URI">
                    <button id="load-button">Load</button>
                </div>
            </div>
            <div id="blast">
                <div id="controls">
                    <span id="statusContainer">ready</span>
                    <button id="runButton" class="primary" title="Run the program">
                      <svg class="icon icon-play">
                        <use xlink:href="media/symbol-defs.svg#icon-play"></use>
                      </svg>
                    </button>
                </div>
                <table width="100%" height="100%">
                    <tr>
                      <td>
                        <table width="100%">
                          <tr id="tabRow" height="1em">
                            <td id="tab_workspace" class="tabon">Workspace</td>
                            <td class="tabmin">&nbsp;</td>
                            <td id="tab_javascript" class="taboff">JavaScript</td>
                            <td class="tabmin">&nbsp;</td>
                            <td id="tab_xml" class="taboff">XML</td>
                            <td class="tabmin">&nbsp;</td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                    <tr>
                      <td id="content_area">
                      </td>
                      <td id="output_area">
                        <div id="msgOutputContainer">
                        </div>
                      </td>
                    </tr>
                  </table>

                  <div id="content_workspace" class="content"></div>
                  <pre id="content_javascript" class="content prettyprint lang-js"></pre>
                  <textarea id="content_xml" class="content" wrap="off"></textarea>
            </div>
        </div>
    </div>
    <script>
        Blast.bindClick('load-button', function() {
            // hide the load container
            document.getElementById('load').style.display = 'none';
            // show blast
            document.getElementById('blast').style.display = 'block';
            // adjust workspace and toolbox on resize
            const container = document.getElementById('content_area');
            const onresize = function() {
                const bBox = Blast.getBBox_(container);
                for (const tab of Blast.Ui.TABS_) {
                const el = document.getElementById('content_' + tab);
                el.style.top = bBox.y + 'px';
                el.style.left = bBox.x + 'px';
                // Height and width need to be set, read back, then set again to
                // compensate for scrollbars.
                el.style.height = bBox.height + 'px';
                el.style.height = 2 * bBox.height - el.offsetHeight + 'px';
                el.style.width = bBox.width + 'px';
                el.style.width = 2 * bBox.width - el.offsetWidth + 'px';
                }
            };
            window.addEventListener('resize', onresize, false);

            Blast.workspace = Blockly.inject('content_workspace', {
                // grid: {spacing: 25, length: 3, colour: '#ccc', snap: true},
                media: 'media/',
                readOnly: true,
            });

            onresize();
            Blockly.svgResize(Blast.workspace);

            // Initialize UI
            Blast.Ui.init();
            Blast.Ui.setStatus(Blast.status.READY);

            // Load the interpreter now, and upon future changes.
            Blast.generateCode();
            Blast.workspace.addChangeListener(function(event) {
                if (!(event instanceof Blockly.Events.Ui)) {
                // Something changed. Parser needs to be reloaded.
                Blast.generateCode();
                Blast.States.generateCode();
                Blast.Ui.renderContent_();
                }
            });
            // load the workspace
            Blast.Storage.load();
        });
    </script>
</body>
</html>
